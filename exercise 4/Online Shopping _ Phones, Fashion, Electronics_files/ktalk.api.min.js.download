function b64_sha1(e){return binb2b64(core_sha1(str2binb(e),8*e.length))}function str_sha1(e){return binb2str(core_sha1(str2binb(e),8*e.length))}function b64_hmac_sha1(e,t){return binb2b64(core_hmac_sha1(e,t))}function str_hmac_sha1(e,t){return binb2str(core_hmac_sha1(e,t))}function core_sha1(e,t){e[t>>5]|=128<<24-t%32,e[(t+64>>9<<4)+15]=t;var n,i,o,s,r,a,l,h,c=new Array(80),d=1732584193,u=-271733879,_=-1732584194,p=271733878,m=-1009589776;for(n=0;n<e.length;n+=16){for(s=d,r=u,a=_,l=p,h=m,i=0;80>i;i++)16>i?c[i]=e[n+i]:c[i]=rol(c[i-3]^c[i-8]^c[i-14]^c[i-16],1),o=safe_add(safe_add(rol(d,5),sha1_ft(i,u,_,p)),safe_add(safe_add(m,c[i]),sha1_kt(i))),m=p,p=_,_=rol(u,30),u=d,d=o;d=safe_add(d,s),u=safe_add(u,r),_=safe_add(_,a),p=safe_add(p,l),m=safe_add(m,h)}return[d,u,_,p,m]}function sha1_ft(e,t,n,i){return 20>e?t&n|~t&i:40>e?t^n^i:60>e?t&n|t&i|n&i:t^n^i}function sha1_kt(e){return 20>e?1518500249:40>e?1859775393:60>e?-1894007588:-899497514}function core_hmac_sha1(e,t){var n=str2binb(e);n.length>16&&(n=core_sha1(n,8*e.length));for(var i=new Array(16),o=new Array(16),s=0;16>s;s++)i[s]=909522486^n[s],o[s]=1549556828^n[s];var r=core_sha1(i.concat(str2binb(t)),512+8*t.length);return core_sha1(o.concat(r),672)}function safe_add(e,t){var n=(65535&e)+(65535&t),i=(e>>16)+(t>>16)+(n>>16);return i<<16|65535&n}function rol(e,t){return e<<t|e>>>32-t}function str2binb(e){for(var t=[],n=255,i=0;i<8*e.length;i+=8)t[i>>5]|=(e.charCodeAt(i/8)&n)<<24-i%32;return t}function binb2str(e){for(var t="",n=255,i=0;i<32*e.length;i+=8)t+=String.fromCharCode(e[i>>5]>>>24-i%32&n);return t}function binb2b64(e){for(var t,n,i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",o="",s=0;s<4*e.length;s+=3)for(t=(e[s>>2]>>8*(3-s%4)&255)<<16|(e[s+1>>2]>>8*(3-(s+1)%4)&255)<<8|e[s+2>>2]>>8*(3-(s+2)%4)&255,n=0;4>n;n++)o+=8*s+6*n>32*e.length?"=":i.charAt(t>>6*(3-n)&63);return o}Date.prototype.toRelativeTime=function(){var e=function(e){var s=t(e),r=s.now||new Date,a=r-this,l=0>=a;if(a=Math.abs(a),a<=s.nowThreshold)return l?"Right now":"Just now";if(s.smartDays&&6*o>=a)return n(this,r);var h=null;for(var c in i){if(a<i[c])break;h=c,a/=i[c]}return a=Math.floor(a),1!==a&&(h+="s"),[a,h,l?"from now":"ago"].join(" ")},t=function(e){return e||(e=0),"string"==typeof e&&(e=parseInt(e,10)),"number"==typeof e?(isNaN(e)&&(e=0),{nowThreshold:e}):e},n=function(e,t){var n,i=e.getDay(),o=i-t.getDay();return n=0==o?"Today":-1==o?"Yesterday":1==o&&e>t?"Tomorrow":s[i],n+" at "+e.toLocaleTimeString()},i={millisecond:1,second:1e3,minute:60,hour:60,day:24,month:30,year:12},o=i.millisecond*i.second*i.minute*i.hour*i.day,s=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"];return e}(),Date.fromString=function(e){return new Date(Date.parse(e))},function(e){jQuery.fn.extend({elastic:function(){var t=["paddingTop","paddingRight","paddingBottom","paddingLeft","fontSize","lineHeight","fontFamily","width","fontWeight","border-top-width","border-right-width","border-bottom-width","border-left-width","borderTopStyle","borderTopColor","borderRightStyle","borderRightColor","borderBottomStyle","borderBottomColor","borderLeftStyle","borderLeftColor"];return this.each(function(){function n(){var e=Math.floor(parseInt(s.width(),10));r.width()!==e&&(r.css({width:e+"px"}),o(!0))}function i(e,t){var n=Math.floor(parseInt(e,10));s.height()!==n&&s.css({height:n+"px",overflow:t})}function o(e){var t=s.val().replace(/&/g,"&amp;").replace(/ {2}/g,"&nbsp;").replace(/<|>/g,"&gt;").replace(/\n/g,"<br />"),n=r.html().replace(/<br>/gi,"<br />");if((e||t+"&nbsp;"!==n)&&(r.html(t+"&nbsp;"),Math.abs(r.height()+a-s.height())>3)){var o=r.height()+a;o>=h?i(h,"auto"):l>=o?i(l,"hidden"):i(o,"hidden")}}if("textarea"!==this.type)return!1;var s=jQuery(this),r=jQuery("<div />").css({position:"absolute",display:"none","word-wrap":"break-word","white-space":"pre-wrap"}),a=parseInt(s.css("line-height"),10)||parseInt(s.css("font-size"),"10"),l=parseInt(s.css("height"),10)||3*a,h=parseInt(s.css("max-height"),10)||Number.MAX_VALUE;0>h&&(h=Number.MAX_VALUE),r.appendTo(s.parent());for(var c=t.length;c--;)r.css(t[c].toString(),s.css(t[c].toString()));s.css({overflow:"hidden"}),s.bind("keyup change cut paste",function(){o()}),e(window).bind("resize",n),s.bind("resize",n),s.bind("update",o),s.bind("blur",function(){r.height()<h&&(r.height()>l?s.height(r.height()):s.height(l))}),s.bind("input paste",function(e){setTimeout(o,250)}),o()})}})}(jQuery),window.linkify=function(){var e="[a-z\\d.-]+://",t="(?:(?:[0-9]|[1-9]\\d|1\\d{2}|2[0-4]\\d|25[0-5])\\.){3}(?:[0-9]|[1-9]\\d|1\\d{2}|2[0-4]\\d|25[0-5])",n="(?:(?:[^\\s!@#$%^&*()_=+[\\]{}\\\\|;:'\",.<>/?]+)\\.)+",i="(?:ac|ad|aero|ae|af|ag|ai|al|am|an|ao|aq|arpa|ar|asia|as|at|au|aw|ax|az|ba|bb|bd|be|bf|bg|bh|biz|bi|bj|bm|bn|bo|br|bs|bt|bv|bw|by|bz|cat|ca|cc|cd|cf|cg|ch|ci|ck|cl|cm|cn|coop|com|co|cr|cu|cv|cx|cy|cz|de|dj|dk|dm|do|dz|ec|edu|ee|eg|er|es|et|eu|fi|fj|fk|fm|fo|fr|ga|gb|gd|ge|gf|gg|gh|gi|gl|gm|gn|gov|gp|gq|gr|gs|gt|gu|gw|gy|hk|hm|hn|hr|ht|hu|id|ie|il|im|info|int|in|io|iq|ir|is|it|je|jm|jobs|jo|jp|ke|kg|kh|ki|km|kn|kp|kr|kw|ky|kz|la|lb|lc|li|lk|lr|ls|lt|lu|lv|ly|ma|mc|md|me|mg|mh|mil|mk|ml|mm|mn|mobi|mo|mp|mq|mr|ms|mt|museum|mu|mv|mw|mx|my|mz|name|na|nc|net|ne|nf|ng|ni|nl|no|np|nr|nu|nz|om|org|pa|pe|pf|pg|ph|pk|pl|pm|pn|pro|pr|ps|pt|pw|py|qa|re|ro|rs|ru|rw|sa|sb|sc|sd|se|sg|sh|si|sj|sk|sl|sm|sn|so|sr|st|su|sv|sy|sz|tc|td|tel|tf|tg|th|tj|tk|tl|tm|tn|to|tp|travel|tr|tt|tv|tw|tz|ua|ug|uk|um|us|uy|uz|va|vc|ve|vg|vi|vn|vu|wf|ws|xn--0zwm56d|xn--11b5bs3a9aj6g|xn--80akhbyknj4f|xn--9t4b11yi5a|xn--deba0ad|xn--g6w251d|xn--hgbk6aj7f53bba|xn--hlcj6aya9esc7a|xn--jxalpdlp|xn--kgbechtv|xn--zckzah|ye|yt|yu|za|zm|zw)",o="(?:"+n+i+"|"+t+")",s="(?:[;/][^#?<>\\s]*)?",r="(?:\\?[^#<>\\s]*)?(?:#[^<>\\s]*)?",a="\\b"+e+"[^<>\\s]+",l="\\b"+o+s+r+"(?!\\w)",h="mailto:",c="(?:"+h+")?[a-z0-9!#$%&'*+/=?^_`{|}~-]+(?:\\.[a-z0-9!#$%&'*+/=?^_`{|}~-]+)*@"+o+r+"(?!\\w)",d=new RegExp("(?:"+a+"|"+l+"|"+c+")","ig"),u=new RegExp("^"+e,"i"),_={"'":"`",">":"<",")":"(","]":"[","}":"{","Ãƒâ€šÃ‚Â»":"Ãƒâ€šÃ‚Â«","ÃƒÂ¢Ã¢â€šÂ¬Ã‚Âº":"ÃƒÂ¢Ã¢â€šÂ¬Ã‚Â¹"},p={callback:function(e,t){return t?'<a target="_blank" href="'+t+'" title="'+t+'">'+e+"</a>":e},punct_regexp:/(?:[!?.,:;'"]|(?:&|&amp;)(?:lt|gt|quot|apos|raquo|laquo|rsaquo|lsaquo);)$/};return function(e,t){t=t||{};var n,i,o,s,r,a,l,c,m,f,g,v,k="",y=[];for(i in p)void 0===t[i]&&(t[i]=p[i]);for(;n=d.exec(e);)if(o=n[0],a=d.lastIndex,l=a-o.length,!/[\/:]/.test(e.charAt(l-1))){do c=o,v=o.substr(-1),g=_[v],g&&(m=o.match(new RegExp("\\"+g+"(?!$)","g")),f=o.match(new RegExp("\\"+v,"g")),(m?m.length:0)<(f?f.length:0)&&(o=o.substr(0,o.length-1),a--)),t.punct_regexp&&(o=o.replace(t.punct_regexp,function(e){return a-=e.length,""}));while(o.length&&o!==c);s=o,u.test(s)||(s=(-1!==s.indexOf("@")?s.indexOf(h)?h:"":s.indexOf("irc.")?s.indexOf("ftp.")?"http://":"ftp://":"irc://")+s),r!=l&&(y.push([e.slice(r,l)]),r=a),y.push([o,s])}for(y.push([e.substr(r)]),i=0;i<y.length;i++)k+=t.callback.apply(window,y[i]);return k||e}}();var Base64=function(){var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",t={encode:function(t){var n,i,o,s,r,a,l,h="",c=0;do n=t.charCodeAt(c++),i=t.charCodeAt(c++),o=t.charCodeAt(c++),s=n>>2,r=(3&n)<<4|i>>4,a=(15&i)<<2|o>>6,l=63&o,isNaN(i)?a=l=64:isNaN(o)&&(l=64),h=h+e.charAt(s)+e.charAt(r)+e.charAt(a)+e.charAt(l);while(c<t.length);return h},decode:function(t){var n,i,o,s,r,a,l,h="",c=0;t=t.replace(/[^A-Za-z0-9\+\/\=]/g,"");do s=e.indexOf(t.charAt(c++)),r=e.indexOf(t.charAt(c++)),a=e.indexOf(t.charAt(c++)),l=e.indexOf(t.charAt(c++)),n=s<<2|r>>4,i=(15&r)<<4|a>>2,o=(3&a)<<6|l,h+=String.fromCharCode(n),64!=a&&(h+=String.fromCharCode(i)),64!=l&&(h+=String.fromCharCode(o));while(c<t.length);return h}};return t}(),MD5=function(){var e=function(e,t){var n=(65535&e)+(65535&t),i=(e>>16)+(t>>16)+(n>>16);return i<<16|65535&n},t=function(e,t){return e<<t|e>>>32-t},n=function(e){for(var t=[],n=0;n<8*e.length;n+=8)t[n>>5]|=(255&e.charCodeAt(n/8))<<n%32;return t},i=function(e){for(var t="",n=0;n<32*e.length;n+=8)t+=String.fromCharCode(e[n>>5]>>>n%32&255);return t},o=function(e){for(var t="0123456789abcdef",n="",i=0;i<4*e.length;i++)n+=t.charAt(e[i>>2]>>i%4*8+4&15)+t.charAt(e[i>>2]>>i%4*8&15);return n},s=function(n,i,o,s,r,a){return e(t(e(e(i,n),e(s,a)),r),o)},r=function(e,t,n,i,o,r,a){return s(t&n|~t&i,e,t,o,r,a)},a=function(e,t,n,i,o,r,a){return s(t&i|n&~i,e,t,o,r,a)},l=function(e,t,n,i,o,r,a){return s(t^n^i,e,t,o,r,a)},h=function(e,t,n,i,o,r,a){return s(n^(t|~i),e,t,o,r,a)},c=function(t,n){t[n>>5]|=128<<n%32,t[(n+64>>>9<<4)+14]=n;for(var i,o,s,c,d=1732584193,u=-271733879,_=-1732584194,p=271733878,m=0;m<t.length;m+=16)i=d,o=u,s=_,c=p,d=r(d,u,_,p,t[m+0],7,-680876936),p=r(p,d,u,_,t[m+1],12,-389564586),_=r(_,p,d,u,t[m+2],17,606105819),u=r(u,_,p,d,t[m+3],22,-1044525330),d=r(d,u,_,p,t[m+4],7,-176418897),p=r(p,d,u,_,t[m+5],12,1200080426),_=r(_,p,d,u,t[m+6],17,-1473231341),u=r(u,_,p,d,t[m+7],22,-45705983),d=r(d,u,_,p,t[m+8],7,1770035416),p=r(p,d,u,_,t[m+9],12,-1958414417),_=r(_,p,d,u,t[m+10],17,-42063),u=r(u,_,p,d,t[m+11],22,-1990404162),d=r(d,u,_,p,t[m+12],7,1804603682),p=r(p,d,u,_,t[m+13],12,-40341101),_=r(_,p,d,u,t[m+14],17,-1502002290),u=r(u,_,p,d,t[m+15],22,1236535329),d=a(d,u,_,p,t[m+1],5,-165796510),p=a(p,d,u,_,t[m+6],9,-1069501632),_=a(_,p,d,u,t[m+11],14,643717713),u=a(u,_,p,d,t[m+0],20,-373897302),d=a(d,u,_,p,t[m+5],5,-701558691),p=a(p,d,u,_,t[m+10],9,38016083),_=a(_,p,d,u,t[m+15],14,-660478335),u=a(u,_,p,d,t[m+4],20,-405537848),d=a(d,u,_,p,t[m+9],5,568446438),p=a(p,d,u,_,t[m+14],9,-1019803690),_=a(_,p,d,u,t[m+3],14,-187363961),u=a(u,_,p,d,t[m+8],20,1163531501),d=a(d,u,_,p,t[m+13],5,-1444681467),p=a(p,d,u,_,t[m+2],9,-51403784),_=a(_,p,d,u,t[m+7],14,1735328473),u=a(u,_,p,d,t[m+12],20,-1926607734),d=l(d,u,_,p,t[m+5],4,-378558),p=l(p,d,u,_,t[m+8],11,-2022574463),_=l(_,p,d,u,t[m+11],16,1839030562),u=l(u,_,p,d,t[m+14],23,-35309556),d=l(d,u,_,p,t[m+1],4,-1530992060),p=l(p,d,u,_,t[m+4],11,1272893353),_=l(_,p,d,u,t[m+7],16,-155497632),u=l(u,_,p,d,t[m+10],23,-1094730640),d=l(d,u,_,p,t[m+13],4,681279174),p=l(p,d,u,_,t[m+0],11,-358537222),_=l(_,p,d,u,t[m+3],16,-722521979),u=l(u,_,p,d,t[m+6],23,76029189),d=l(d,u,_,p,t[m+9],4,-640364487),p=l(p,d,u,_,t[m+12],11,-421815835),_=l(_,p,d,u,t[m+15],16,530742520),u=l(u,_,p,d,t[m+2],23,-995338651),d=h(d,u,_,p,t[m+0],6,-198630844),p=h(p,d,u,_,t[m+7],10,1126891415),_=h(_,p,d,u,t[m+14],15,-1416354905),u=h(u,_,p,d,t[m+5],21,-57434055),d=h(d,u,_,p,t[m+12],6,1700485571),p=h(p,d,u,_,t[m+3],10,-1894986606),_=h(_,p,d,u,t[m+10],15,-1051523),u=h(u,_,p,d,t[m+1],21,-2054922799),d=h(d,u,_,p,t[m+8],6,1873313359),p=h(p,d,u,_,t[m+15],10,-30611744),_=h(_,p,d,u,t[m+6],15,-1560198380),u=h(u,_,p,d,t[m+13],21,1309151649),d=h(d,u,_,p,t[m+4],6,-145523070),p=h(p,d,u,_,t[m+11],10,-1120210379),_=h(_,p,d,u,t[m+2],15,718787259),u=h(u,_,p,d,t[m+9],21,-343485551),d=e(d,i),u=e(u,o),_=e(_,s),p=e(p,c);return[d,u,_,p]},d={hexdigest:function(e){return o(c(n(e),8*e.length))},hash:function(e){return i(c(n(e),8*e.length))}};return d}();Function.prototype.bind||(Function.prototype.bind=function(e){var t=this,n=Array.prototype.slice,i=Array.prototype.concat,o=n.call(arguments,1);return function(){return t.apply(e?e:this,i.call(o,n.call(arguments,0)))}}),Array.prototype.indexOf||(Array.prototype.indexOf=function(e){var t=this.length,n=Number(arguments[1])||0;for(n=0>n?Math.ceil(n):Math.floor(n),0>n&&(n+=t);t>n;n++)if(n in this&&this[n]===e)return n;return-1}),function(e){function t(e,t){return new s.Builder(e,t)}function n(e){return new s.Builder("message",e)}function i(e){return new s.Builder("iq",e)}function o(e){return new s.Builder("presence",e)}var s;s={VERSION:"1.1.3",NS:{HTTPBIND:"http://jabber.org/protocol/httpbind",BOSH:"urn:xmpp:xbosh",CLIENT:"jabber:client",AUTH:"jabber:iq:auth",ROSTER:"jabber:iq:roster",PROFILE:"jabber:iq:profile",DISCO_INFO:"http://jabber.org/protocol/disco#info",DISCO_ITEMS:"http://jabber.org/protocol/disco#items",MUC:"http://jabber.org/protocol/muc",SASL:"urn:ietf:params:xml:ns:xmpp-sasl",STREAM:"http://etherx.jabber.org/streams",BIND:"urn:ietf:params:xml:ns:xmpp-bind",SESSION:"urn:ietf:params:xml:ns:xmpp-session",VERSION:"jabber:iq:version",STANZAS:"urn:ietf:params:xml:ns:xmpp-stanzas",XHTML_IM:"http://jabber.org/protocol/xhtml-im",XHTML:"http://www.w3.org/1999/xhtml"},XHTML:{tags:["a","blockquote","br","cite","em","img","li","ol","p","span","strong","ul","body"],attributes:{a:["href"],blockquote:["style"],br:[],cite:["style"],em:[],img:["src","alt","style","height","width"],li:["style"],ol:["style"],p:["style"],span:["style"],strong:[],ul:["style"],body:[]},css:["background-color","color","font-family","font-size","font-style","font-weight","margin-left","margin-right","text-align","text-decoration"],validTag:function(e){for(var t=0;t<s.XHTML.tags.length;t++)if(e==s.XHTML.tags[t])return!0;return!1},validAttribute:function(e,t){if("undefined"!=typeof s.XHTML.attributes[e]&&s.XHTML.attributes[e].length>0)for(var n=0;n<s.XHTML.attributes[e].length;n++)if(t==s.XHTML.attributes[e][n])return!0;return!1},validCSS:function(e){for(var t=0;t<s.XHTML.css.length;t++)if(e==s.XHTML.css[t])return!0;return!1}},Status:{ERROR:0,CONNECTING:1,CONNFAIL:2,AUTHENTICATING:3,AUTHFAIL:4,CONNECTED:5,DISCONNECTED:6,DISCONNECTING:7,ATTACHED:8},LogLevel:{DEBUG:0,INFO:1,WARN:2,ERROR:3,FATAL:4},ElementType:{NORMAL:1,TEXT:3,CDATA:4,FRAGMENT:11},TIMEOUT:1.1,SECONDARY_TIMEOUT:.1,addNamespace:function(e,t){s.NS[e]=t},forEachChild:function(e,t,n){var i,o;for(i=0;i<e.childNodes.length;i++)o=e.childNodes[i],o.nodeType!=s.ElementType.NORMAL||t&&!this.isTagEqual(o,t)||n(o)},isTagEqual:function(e,t){return e.tagName.toLowerCase()==t.toLowerCase()},_xmlGenerator:null,_makeGenerator:function(){var e;return void 0===document.implementation.createDocument||document.implementation.createDocument&&document.documentMode&&document.documentMode<10?(e=this._getIEXmlDom(),e.appendChild(e.createElement("strophe"))):e=document.implementation.createDocument("jabber:client","strophe",null),e},xmlGenerator:function(){return s._xmlGenerator||(s._xmlGenerator=s._makeGenerator()),s._xmlGenerator},_getIEXmlDom:function(){for(var e=null,t=["Msxml2.DOMDocument.6.0","Msxml2.DOMDocument.5.0","Msxml2.DOMDocument.4.0","MSXML2.DOMDocument.3.0","MSXML2.DOMDocument","MSXML.DOMDocument","Microsoft.XMLDOM"],n=0;n<t.length&&null===e;n++)try{e=new ActiveXObject(t[n])}catch(i){e=null}return e},xmlElement:function(e){if(!e)return null;var t,n,i,o=s.xmlGenerator().createElement(e);for(t=1;t<arguments.length;t++)if(arguments[t])if("string"==typeof arguments[t]||"number"==typeof arguments[t])o.appendChild(s.xmlTextNode(arguments[t]));else if("object"==typeof arguments[t]&&"function"==typeof arguments[t].sort)for(n=0;n<arguments[t].length;n++)"object"==typeof arguments[t][n]&&"function"==typeof arguments[t][n].sort&&o.setAttribute(arguments[t][n][0],arguments[t][n][1]);else if("object"==typeof arguments[t])for(i in arguments[t])arguments[t].hasOwnProperty(i)&&o.setAttribute(i,arguments[t][i]);return o},xmlescape:function(e){return e=e.replace(/\&/g,"&amp;"),e=e.replace(/</g,"&lt;"),e=e.replace(/>/g,"&gt;"),e=e.replace(/'/g,"&apos;"),e=e.replace(/"/g,"&quot;")},xmlTextNode:function(e){return s.xmlGenerator().createTextNode(e)},xmlHtmlNode:function(e){var t;if(window.DOMParser){var n=new DOMParser;t=n.parseFromString(e,"text/xml")}else t=new ActiveXObject("Microsoft.XMLDOM"),t.async="false",t.loadXML(e);return t},getText:function(e){if(!e)return null;var t="";0===e.childNodes.length&&e.nodeType==s.ElementType.TEXT&&(t+=e.nodeValue);for(var n=0;n<e.childNodes.length;n++)e.childNodes[n].nodeType==s.ElementType.TEXT&&(t+=e.childNodes[n].nodeValue);return s.xmlescape(t)},copyElement:function(e){var t,n;if(e.nodeType==s.ElementType.NORMAL){for(n=s.xmlElement(e.tagName),t=0;t<e.attributes.length;t++)n.setAttribute(e.attributes[t].nodeName.toLowerCase(),e.attributes[t].value);for(t=0;t<e.childNodes.length;t++)n.appendChild(s.copyElement(e.childNodes[t]))}else e.nodeType==s.ElementType.TEXT&&(n=s.xmlGenerator().createTextNode(e.nodeValue));return n},createHtml:function(e){var t,n,i,o,r,a,l,h,c,d,u;if(e.nodeType==s.ElementType.NORMAL)if(o=e.nodeName.toLowerCase(),s.XHTML.validTag(o))try{for(n=s.xmlElement(o),t=0;t<s.XHTML.attributes[o].length;t++)if(r=s.XHTML.attributes[o][t],a=e.getAttribute(r),"undefined"!=typeof a&&null!==a&&""!==a&&a!==!1&&0!==a)if("style"==r&&"object"==typeof a&&"undefined"!=typeof a.cssText&&(a=a.cssText),"style"==r){for(l=[],h=a.split(";"),i=0;i<h.length;i++)c=h[i].split(":"),d=c[0].replace(/^\s*/,"").replace(/\s*$/,"").toLowerCase(),s.XHTML.validCSS(d)&&(u=c[1].replace(/^\s*/,"").replace(/\s*$/,""),l.push(d+": "+u));l.length>0&&(a=l.join("; "),n.setAttribute(r,a))}else n.setAttribute(r,a);for(t=0;t<e.childNodes.length;t++)n.appendChild(s.createHtml(e.childNodes[t]))}catch(_){n=s.xmlTextNode("")}else for(n=s.xmlGenerator().createDocumentFragment(),t=0;t<e.childNodes.length;t++)n.appendChild(s.createHtml(e.childNodes[t]));else if(e.nodeType==s.ElementType.FRAGMENT)for(n=s.xmlGenerator().createDocumentFragment(),t=0;t<e.childNodes.length;t++)n.appendChild(s.createHtml(e.childNodes[t]));else e.nodeType==s.ElementType.TEXT&&(n=s.xmlTextNode(e.nodeValue));return n},escapeNode:function(e){return e.replace(/^\s+|\s+$/g,"").replace(/\\/g,"\\5c").replace(/ /g,"\\20").replace(/\"/g,"\\22").replace(/\&/g,"\\26").replace(/\'/g,"\\27").replace(/\//g,"\\2f").replace(/:/g,"\\3a").replace(/</g,"\\3c").replace(/>/g,"\\3e").replace(/@/g,"\\40")},unescapeNode:function(e){return e.replace(/\\20/g," ").replace(/\\22/g,'"').replace(/\\26/g,"&").replace(/\\27/g,"'").replace(/\\2f/g,"/").replace(/\\3a/g,":").replace(/\\3c/g,"<").replace(/\\3e/g,">").replace(/\\40/g,"@").replace(/\\5c/g,"\\")},getNodeFromJid:function(e){return e.indexOf("@")<0?null:e.split("@")[0]},getDomainFromJid:function(e){var t=s.getBareJidFromJid(e);if(t.indexOf("@")<0)return t;var n=t.split("@");return n.splice(0,1),n.join("@")},getResourceFromJid:function(e){var t=e.split("/");return t.length<2?null:(t.splice(0,1),t.join("/"))},getBareJidFromJid:function(e){return e?e.split("/")[0]:null},log:function(e,t){},debug:function(e){this.log(this.LogLevel.DEBUG,e)},info:function(e){this.log(this.LogLevel.INFO,e)},warn:function(e){this.log(this.LogLevel.WARN,e)},error:function(e){this.log(this.LogLevel.ERROR,e)},fatal:function(e){this.log(this.LogLevel.FATAL,e)},serialize:function(e){var t;if(!e)return null;"function"==typeof e.tree&&(e=e.tree());var n,i,o=e.nodeName;for(e.getAttribute("_realname")&&(o=e.getAttribute("_realname")),t="<"+o,n=0;n<e.attributes.length;n++)"_realname"!=e.attributes[n].nodeName&&(t+=" "+e.attributes[n].nodeName.toLowerCase()+"='"+e.attributes[n].value.replace(/&/g,"&amp;").replace(/\'/g,"&apos;").replace(/>/g,"&gt;").replace(/</g,"&lt;")+"'");if(e.childNodes.length>0){for(t+=">",n=0;n<e.childNodes.length;n++)switch(i=e.childNodes[n],i.nodeType){case s.ElementType.NORMAL:t+=s.serialize(i);break;case s.ElementType.TEXT:t+=s.xmlescape(i.nodeValue);break;case s.ElementType.CDATA:t+="<![CDATA["+i.nodeValue+"]]>"}t+="</"+o+">"}else t+="/>";return t},_requestId:0,_connectionPlugins:{},addConnectionPlugin:function(e,t){s._connectionPlugins[e]=t}},s.Builder=function(e,t){("presence"==e||"message"==e||"iq"==e)&&(t&&!t.xmlns?t.xmlns=s.NS.CLIENT:t||(t={xmlns:s.NS.CLIENT})),this.nodeTree=s.xmlElement(e,t),this.node=this.nodeTree},s.Builder.prototype={tree:function(){return this.nodeTree},toString:function(){return s.serialize(this.nodeTree)},up:function(){return this.node=this.node.parentNode,this},attrs:function(e){for(var t in e)e.hasOwnProperty(t)&&this.node.setAttribute(t,e[t]);return this},c:function(e,t,n){var i=s.xmlElement(e,t,n);return this.node.appendChild(i),n||(this.node=i),this},cnode:function(e){var t,n=s.xmlGenerator();try{t=void 0!==n.importNode}catch(i){t=!1}var o=t?n.importNode(e,!0):s.copyElement(e);return this.node.appendChild(o),this.node=o,this},t:function(e){var t=s.xmlTextNode(e);return this.node.appendChild(t),this},h:function(e){var t=document.createElement("body");t.innerHTML=e;for(var n=s.createHtml(t);n.childNodes.length>0;)this.node.appendChild(n.childNodes[0]);return this}},s.Handler=function(e,t,n,i,o,r,a){this.handler=e,this.ns=t,this.name=n,this.type=i,this.id=o,this.options=a||{matchBare:!1},this.options.matchBare||(this.options.matchBare=!1),this.options.matchBare?this.from=r?s.getBareJidFromJid(r):null:this.from=r,this.user=!0},s.Handler.prototype={isMatch:function(e){var t,n=null;if(n=this.options.matchBare?s.getBareJidFromJid(e.getAttribute("from")):e.getAttribute("from"),t=!1,this.ns){var i=this;s.forEachChild(e,null,function(e){e.getAttribute("xmlns")==i.ns&&(t=!0)}),t=t||e.getAttribute("xmlns")==this.ns}else t=!0;return!t||this.name&&!s.isTagEqual(e,this.name)||this.type&&e.getAttribute("type")!=this.type||this.id&&e.getAttribute("id")!=this.id||this.from&&n!=this.from?!1:!0},run:function(e){var t=null;try{t=this.handler(e)}catch(n){throw n.sourceURL?s.fatal("error: "+this.handler+" "+n.sourceURL+":"+n.line+" - "+n.name+": "+n.message):n.fileName?("undefined"!=typeof console&&(console.trace(),console.error(this.handler," - error - ",n,n.message)),s.fatal("error: "+this.handler+" "+n.fileName+":"+n.lineNumber+" - "+n.name+": "+n.message)):s.fatal("error: "+n.message+"\n"+n.stack),n}return t},toString:function(){return"{Handler: "+this.handler+"("+this.name+","+this.id+","+this.ns+")}"}},s.TimedHandler=function(e,t){this.period=e,this.handler=t,this.lastCalled=(new Date).getTime(),this.user=!0},s.TimedHandler.prototype={run:function(){return this.lastCalled=(new Date).getTime(),this.handler()},reset:function(){this.lastCalled=(new Date).getTime()},toString:function(){return"{TimedHandler: "+this.handler+"("+this.period+")}"}},s.Connection=function(e,t){this.service=e,this.options=t||{};var n=this.options.protocol||"";0===e.indexOf("ws:")||0===e.indexOf("wss:")||0===n.indexOf("ws")?this._proto=new s.Websocket(this):this._proto=new s.Bosh(this),this.jid="",this.domain=null,this.features=null,this._sasl_data={},this.do_session=!1,this.do_bind=!1,this.timedHandlers=[],this.handlers=[],this.removeTimeds=[],this.removeHandlers=[],this.addTimeds=[],this.addHandlers=[],this._authentication={},this._idleTimeout=null,this._disconnectTimeout=null,this.do_authentication=!0,this.authenticated=!1,this.disconnecting=!1,this.connected=!1,this.errors=0,this.paused=!1,this._data=[],this._uniqueId=0,this._sasl_success_handler=null,this._sasl_failure_handler=null,this._sasl_challenge_handler=null,this.maxRetries=5,this._idleTimeout=setTimeout(this._onIdle.bind(this),100);for(var i in s._connectionPlugins)if(s._connectionPlugins.hasOwnProperty(i)){var o=s._connectionPlugins[i],r=function(){};r.prototype=o,this[i]=new r,this[i].init(this)}},s.Connection.prototype={reset:function(){this._proto._reset(),this.do_session=!1,this.do_bind=!1,this.timedHandlers=[],this.handlers=[],this.removeTimeds=[],this.removeHandlers=[],this.addTimeds=[],this.addHandlers=[],this._authentication={},this.authenticated=!1,this.disconnecting=!1,this.connected=!1,this.errors=0,this._requests=[],this._uniqueId=0},pause:function(){this.paused=!0},resume:function(){this.paused=!1},getUniqueId:function(e){return"string"==typeof e||"number"==typeof e?++this._uniqueId+":"+e:++this._uniqueId+""},connect:function(e,t,n,i,o,r){this.jid=e,this.authzid=s.getBareJidFromJid(this.jid),this.authcid=s.getNodeFromJid(this.jid),this.pass=t,this.password=t,this.servtype="xmpp",this.connect_callback=n,this.disconnecting=!1,this.connected=!1,this.authenticated=!1,this.errors=0,this.domain=s.getDomainFromJid(this.jid),this._changeConnectStatus(s.Status.CONNECTING,null),this._proto._connect(i,o,r)},attach:function(e,t,n,i,o,s,r){this._proto._attach(e,t,n,i,o,s,r)},xmlInput:function(e){},xmlOutput:function(e){},rawInput:function(e){},rawOutput:function(e){},send:function(e){if(null!==e){if("function"==typeof e.sort)for(var t=0;t<e.length;t++)this._queueData(e[t]);else"function"==typeof e.tree?this._queueData(e.tree()):this._queueData(e);this._proto._send()}},flush:function(){clearTimeout(this._idleTimeout),this._onIdle()},sendIQ:function(e,t,n,i){var o=null,s=this;"function"==typeof e.tree&&(e=e.tree());var r=e.getAttribute("id");r||(r=this.getUniqueId("sendIQ"),e.setAttribute("id",r));var a=this.addHandler(function(e){o&&s.deleteTimedHandler(o);var i=e.getAttribute("type");if("result"==i)t&&t(e);else{if("error"!=i)throw{name:"StropheError",message:"Got bad IQ type of "+i};n&&n(e)}},null,"iq",null,r);return i&&(o=this.addTimedHandler(i,function(){return s.deleteHandler(a),n&&n(null),!1})),this.send(e),r},_queueData:function(e){if(null===e||!e.tagName||!e.childNodes)throw{name:"StropheError",message:"Cannot queue non-DOMElement."};this._data.push(e)},_sendRestart:function(){this._data.push("restart"),this._proto._sendRestart(),this._idleTimeout=setTimeout(this._onIdle.bind(this),100)},addTimedHandler:function(e,t){var n=new s.TimedHandler(e,t);return this.addTimeds.push(n),n},deleteTimedHandler:function(e){this.removeTimeds.push(e)},addHandler:function(e,t,n,i,o,r,a){var l=new s.Handler(e,t,n,i,o,r,a);return this.addHandlers.push(l),l},deleteHandler:function(e){this.removeHandlers.push(e)},disconnect:function(e){if(this._changeConnectStatus(s.Status.DISCONNECTING,e),s.info("Disconnect was called because: "+e),this.connected){var t=!1;this.disconnecting=!0,this.authenticated&&(t=o({xmlns:s.NS.CLIENT,type:"unavailable"})),this._disconnectTimeout=this._addSysTimedHandler(3e3,this._onDisconnectTimeout.bind(this)),this._proto._disconnect(t)}},_changeConnectStatus:function(e,t){for(var n in s._connectionPlugins)if(s._connectionPlugins.hasOwnProperty(n)){var i=this[n];if(i.statusChanged)try{i.statusChanged(e,t)}catch(o){s.error(""+n+" plugin caused an exception changing status: "+o)}}if(this.connect_callback)try{this.connect_callback(e,t)}catch(r){s.error("User connection callback caused an exception: "+r)}},_doDisconnect:function(){null!==this._disconnectTimeout&&(this.deleteTimedHandler(this._disconnectTimeout),this._disconnectTimeout=null),s.info("_doDisconnect was called"),this._proto._doDisconnect(),this.authenticated=!1,this.disconnecting=!1,this.handlers=[],this.timedHandlers=[],this.removeTimeds=[],this.removeHandlers=[],this.addTimeds=[],this.addHandlers=[],this._changeConnectStatus(s.Status.DISCONNECTED,null),this.connected=!1},_dataRecv:function(e,t){s.info("_dataRecv called");var n=this._proto._reqToData(e);if(null!==n){this.xmlInput!==s.Connection.prototype.xmlInput&&(n.nodeName===this._proto.strip&&n.childNodes.length?this.xmlInput(n.childNodes[0]):this.xmlInput(n)),this.rawInput!==s.Connection.prototype.rawInput&&(t?this.rawInput(t):this.rawInput(s.serialize(n)));for(var i,o;this.removeHandlers.length>0;)o=this.removeHandlers.pop(),i=this.handlers.indexOf(o),i>=0&&this.handlers.splice(i,1);for(;this.addHandlers.length>0;)this.handlers.push(this.addHandlers.pop());if(this.disconnecting&&this._proto._emptyQueue())return void this._doDisconnect();var r,a,l=n.getAttribute("type");if(null!==l&&"terminate"==l){if(this.disconnecting)return;return r=n.getAttribute("condition"),a=n.getElementsByTagName("conflict"),null!==r?("remote-stream-error"==r&&a.length>0&&(r="conflict"),this._changeConnectStatus(s.Status.CONNFAIL,r)):this._changeConnectStatus(s.Status.CONNFAIL,"unknown"),void this.disconnect("unknown stream-error")}var h=this;s.forEachChild(n,null,function(e){var t,n;for(n=h.handlers,h.handlers=[],t=0;t<n.length;t++){var i=n[t];try{!i.isMatch(e)||!h.authenticated&&i.user?h.handlers.push(i):i.run(e)&&h.handlers.push(i)}catch(o){s.warn("Removing Strophe handlers due to uncaught exception: "+o.message)}}})}},mechanisms:{},_connect_cb:function(e,t,n){s.info("_connect_cb was called"),this.connected=!0;var i=this._proto._reqToData(e);if(i){this.xmlInput!==s.Connection.prototype.xmlInput&&(i.nodeName===this._proto.strip&&i.childNodes.length?this.xmlInput(i.childNodes[0]):this.xmlInput(i)),this.rawInput!==s.Connection.prototype.rawInput&&(n?this.rawInput(n):this.rawInput(s.serialize(i)));var o=this._proto._connect_cb(i);if(o!==s.Status.CONNFAIL){this._authentication.sasl_scram_sha1=!1,this._authentication.sasl_plain=!1,this._authentication.sasl_digest_md5=!1,this._authentication.sasl_anonymous=!1,this._authentication.legacy_auth=!1;var r=i.getElementsByTagName("stream:features").length>0;r||(r=i.getElementsByTagName("features").length>0);var a,l,h=i.getElementsByTagName("mechanism"),c=[],d=!1;if(!r)return void this._proto._no_auth_received(t);if(h.length>0)for(a=0;a<h.length;a++)l=s.getText(h[a]),this.mechanisms[l]&&c.push(this.mechanisms[l]);return this._authentication.legacy_auth=i.getElementsByTagName("auth").length>0,(d=this._authentication.legacy_auth||c.length>0)?void(this.do_authentication!==!1&&this.authenticate(c)):void this._proto._no_auth_received(t)}}},authenticate:function(e){var n;for(n=0;n<e.length-1;++n){for(var o=n,r=n+1;r<e.length;++r)e[r].prototype.priority>e[o].prototype.priority&&(o=r);if(o!=n){var a=e[n];e[n]=e[o],e[o]=a}}var l=!1;for(n=0;n<e.length;++n)if(e[n].test(this)){this._sasl_success_handler=this._addSysHandler(this._sasl_success_cb.bind(this),null,"success",null,null),this._sasl_failure_handler=this._addSysHandler(this._sasl_failure_cb.bind(this),null,"failure",null,null),this._sasl_challenge_handler=this._addSysHandler(this._sasl_challenge_cb.bind(this),null,"challenge",null,null),this._sasl_mechanism=new e[n],this._sasl_mechanism.onStart(this);var h=t("auth",{xmlns:s.NS.SASL,mechanism:this._sasl_mechanism.name});if(this._sasl_mechanism.isClientFirst){var c=this._sasl_mechanism.onChallenge(this,null);h.t(Base64.encode(c))}this.send(h.tree()),l=!0;break}l||(null===s.getNodeFromJid(this.jid)?(this._changeConnectStatus(s.Status.CONNFAIL,"x-strophe-bad-non-anon-jid"),this.disconnect("x-strophe-bad-non-anon-jid")):(this._changeConnectStatus(s.Status.AUTHENTICATING,null),this._addSysHandler(this._auth1_cb.bind(this),null,null,null,"_auth_1"),this.send(i({type:"get",to:this.domain,id:"_auth_1"}).c("query",{xmlns:s.NS.AUTH}).c("username",{}).t(s.getNodeFromJid(this.jid)).tree())))},_sasl_challenge_cb:function(e){var n=Base64.decode(s.getText(e)),i=this._sasl_mechanism.onChallenge(this,n),o=t("response",{xmlns:s.NS.SASL});return""!==i&&o.t(Base64.encode(i)),this.send(o.tree()),!0},_auth1_cb:function(e){var t=i({type:"set",id:"_auth_2"}).c("query",{xmlns:s.NS.AUTH}).c("username",{}).t(s.getNodeFromJid(this.jid)).up().c("password").t(this.pass);return s.getResourceFromJid(this.jid)||(this.jid=s.getBareJidFromJid(this.jid)+"/strophe"),t.up().c("resource",{}).t(s.getResourceFromJid(this.jid)),this._addSysHandler(this._auth2_cb.bind(this),null,null,null,"_auth_2"),this.send(t.tree()),!1},_sasl_success_cb:function(e){if(this._sasl_data["server-signature"]){var t,n=Base64.decode(s.getText(e)),i=/([a-z]+)=([^,]+)(,|$)/,o=n.match(i);if("v"==o[1]&&(t=o[2]),t!=this._sasl_data["server-signature"])return this.deleteHandler(this._sasl_failure_handler),this._sasl_failure_handler=null,this._sasl_challenge_handler&&(this.deleteHandler(this._sasl_challenge_handler),this._sasl_challenge_handler=null),this._sasl_data={},this._sasl_failure_cb(null)}return s.info("SASL authentication succeeded."),this._sasl_mechanism&&this._sasl_mechanism.onSuccess(),this.deleteHandler(this._sasl_failure_handler),this._sasl_failure_handler=null,this._sasl_challenge_handler&&(this.deleteHandler(this._sasl_challenge_handler),this._sasl_challenge_handler=null),this._addSysHandler(this._sasl_auth1_cb.bind(this),null,"stream:features",null,null),this._sendRestart(),!1},_sasl_auth1_cb:function(e){this.features=e;var t,n;for(t=0;t<e.childNodes.length;t++)n=e.childNodes[t],"bind"==n.nodeName&&(this.do_bind=!0),"session"==n.nodeName&&(this.do_session=!0);if(!this.do_bind)return this._changeConnectStatus(s.Status.AUTHFAIL,null),!1;this._addSysHandler(this._sasl_bind_cb.bind(this),null,null,null,"_bind_auth_2");var o=s.getResourceFromJid(this.jid);return o?this.send(i({type:"set",id:"_bind_auth_2"
}).c("bind",{xmlns:s.NS.BIND}).c("resource",{}).t(o).tree()):this.send(i({type:"set",id:"_bind_auth_2"}).c("bind",{xmlns:s.NS.BIND}).tree()),!1},_sasl_bind_cb:function(e){if("error"==e.getAttribute("type")){s.info("SASL binding failed.");var t,n=e.getElementsByTagName("conflict");return n.length>0&&(t="conflict"),this._changeConnectStatus(s.Status.AUTHFAIL,t),!1}var o,r=e.getElementsByTagName("bind");return r.length>0?(o=r[0].getElementsByTagName("jid"),void(o.length>0&&(this.jid=s.getText(o[0]),this.do_session?(this._addSysHandler(this._sasl_session_cb.bind(this),null,null,null,"_session_auth_2"),this.send(i({type:"set",id:"_session_auth_2"}).c("session",{xmlns:s.NS.SESSION}).tree())):(this.authenticated=!0,this._changeConnectStatus(s.Status.CONNECTED,null))))):(s.info("SASL binding failed."),this._changeConnectStatus(s.Status.AUTHFAIL,null),!1)},_sasl_session_cb:function(e){if("result"==e.getAttribute("type"))this.authenticated=!0,this._changeConnectStatus(s.Status.CONNECTED,null);else if("error"==e.getAttribute("type"))return s.info("Session creation failed."),this._changeConnectStatus(s.Status.AUTHFAIL,null),!1;return!1},_sasl_failure_cb:function(e){return this._sasl_success_handler&&(this.deleteHandler(this._sasl_success_handler),this._sasl_success_handler=null),this._sasl_challenge_handler&&(this.deleteHandler(this._sasl_challenge_handler),this._sasl_challenge_handler=null),this._sasl_mechanism&&this._sasl_mechanism.onFailure(),this._changeConnectStatus(s.Status.AUTHFAIL,null),!1},_auth2_cb:function(e){return"result"==e.getAttribute("type")?(this.authenticated=!0,this._changeConnectStatus(s.Status.CONNECTED,null)):"error"==e.getAttribute("type")&&(this._changeConnectStatus(s.Status.AUTHFAIL,null),this.disconnect("authentication failed")),!1},_addSysTimedHandler:function(e,t){var n=new s.TimedHandler(e,t);return n.user=!1,this.addTimeds.push(n),n},_addSysHandler:function(e,t,n,i,o){var r=new s.Handler(e,t,n,i,o);return r.user=!1,this.addHandlers.push(r),r},_onDisconnectTimeout:function(){return s.info("_onDisconnectTimeout was called"),this._proto._onDisconnectTimeout(),this._doDisconnect(),!1},_onIdle:function(){for(var e,t,n,i;this.addTimeds.length>0;)this.timedHandlers.push(this.addTimeds.pop());for(;this.removeTimeds.length>0;)t=this.removeTimeds.pop(),e=this.timedHandlers.indexOf(t),e>=0&&this.timedHandlers.splice(e,1);var o=(new Date).getTime();for(i=[],e=0;e<this.timedHandlers.length;e++)t=this.timedHandlers[e],(this.authenticated||!t.user)&&(n=t.lastCalled+t.period,0>=n-o?t.run()&&i.push(t):i.push(t));this.timedHandlers=i,clearTimeout(this._idleTimeout),this._proto._onIdle(),this.connected&&(this._idleTimeout=setTimeout(this._onIdle.bind(this),100))}},e&&e(s,t,n,i,o),s.SASLMechanism=function(e,t,n){this.name=e,this.isClientFirst=t,this.priority=n},s.SASLMechanism.prototype={test:function(e){return!0},onStart:function(e){this._connection=e},onChallenge:function(e,t){throw new Error("You should implement challenge handling!")},onFailure:function(){this._connection=null},onSuccess:function(){this._connection=null}},s.SASLAnonymous=function(){},s.SASLAnonymous.prototype=new s.SASLMechanism("ANONYMOUS",!1,10),s.SASLAnonymous.test=function(e){return null===e.authcid},s.Connection.prototype.mechanisms[s.SASLAnonymous.prototype.name]=s.SASLAnonymous,s.SASLPlain=function(){},s.SASLPlain.prototype=new s.SASLMechanism("PLAIN",!0,20),s.SASLPlain.test=function(e){return null!==e.authcid},s.SASLPlain.prototype.onChallenge=function(e){var t=e.authzid;return t+="\x00",t+=e.authcid,t+="\x00",t+=e.pass},s.Connection.prototype.mechanisms[s.SASLPlain.prototype.name]=s.SASLPlain,s.SASLSHA1=function(){},s.SASLSHA1.prototype=new s.SASLMechanism("SCRAM-SHA-1",!0,40),s.SASLSHA1.test=function(e){return null!==e.authcid},s.SASLSHA1.prototype.onChallenge=function(e,t,n){var i=n||MD5.hexdigest(1234567890*Math.random()),o="n="+e.authcid;return o+=",r=",o+=i,e._sasl_data.cnonce=i,e._sasl_data["client-first-message-bare"]=o,o="n,,"+o,this.onChallenge=function(e,t){for(var n,i,o,s,r,a,l,h,c,d,u,_="c=biws,",p=e._sasl_data["client-first-message-bare"]+","+t+",",m=e._sasl_data.cnonce,f=/([a-z]+)=([^,]+)(,|$)/;t.match(f);){var g=t.match(f);switch(t=t.replace(g[0],""),g[1]){case"r":n=g[2];break;case"s":i=g[2];break;case"i":o=g[2]}}if(n.substr(0,m.length)!==m)return e._sasl_data={},e._sasl_failure_cb();for(_+="r="+n,p+=_,i=Base64.decode(i),i+="\x00\x00\x00",s=a=core_hmac_sha1(e.pass,i),l=1;o>l;l++){for(r=core_hmac_sha1(e.pass,binb2str(a)),h=0;5>h;h++)s[h]^=r[h];a=r}for(s=binb2str(s),c=core_hmac_sha1(s,"Client Key"),d=str_hmac_sha1(s,"Server Key"),u=core_hmac_sha1(str_sha1(binb2str(c)),p),e._sasl_data["server-signature"]=b64_hmac_sha1(d,p),h=0;5>h;h++)c[h]^=u[h];return _+=",p="+Base64.encode(binb2str(c))}.bind(this),o},s.Connection.prototype.mechanisms[s.SASLSHA1.prototype.name]=s.SASLSHA1,s.SASLMD5=function(){},s.SASLMD5.prototype=new s.SASLMechanism("DIGEST-MD5",!1,30),s.SASLMD5.test=function(e){return null!==e.authcid},s.SASLMD5.prototype._quote=function(e){return'"'+e.replace(/\\/g,"\\\\").replace(/"/g,'\\"')+'"'},s.SASLMD5.prototype.onChallenge=function(e,t,n){for(var i,o=/([a-z]+)=("[^"]+"|[^,"]+)(?:,|$)/,s=n||MD5.hexdigest(""+1234567890*Math.random()),r="",a=null,l="",h="";t.match(o);)switch(i=t.match(o),t=t.replace(i[0],""),i[2]=i[2].replace(/^"(.+)"$/,"$1"),i[1]){case"realm":r=i[2];break;case"nonce":l=i[2];break;case"qop":h=i[2];break;case"host":a=i[2]}var c=e.servtype+"/"+e.domain;null!==a&&(c=c+"/"+a);var d=MD5.hash(e.authcid+":"+r+":"+this._connection.pass)+":"+l+":"+s,u="AUTHENTICATE:"+c,_="";return _+="charset=utf-8,",_+="username="+this._quote(e.authcid)+",",_+="realm="+this._quote(r)+",",_+="nonce="+this._quote(l)+",",_+="nc=00000001,",_+="cnonce="+this._quote(s)+",",_+="digest-uri="+this._quote(c)+",",_+="response="+MD5.hexdigest(MD5.hexdigest(d)+":"+l+":00000001:"+s+":auth:"+MD5.hexdigest(u))+",",_+="qop=auth",this.onChallenge=function(){return""}.bind(this),_},s.Connection.prototype.mechanisms[s.SASLMD5.prototype.name]=s.SASLMD5}(function(){window.Strophe=arguments[0],window.$build=arguments[1],window.$msg=arguments[2],window.$iq=arguments[3],window.$pres=arguments[4]}),Strophe.Request=function(e,t,n,i){this.id=++Strophe._requestId,this.xmlData=e,this.data=Strophe.serialize(e),this.origFunc=t,this.func=t,this.rid=n,this.date=NaN,this.sends=i||0,this.abort=!1,this.dead=null,this.age=function(){if(!this.date)return 0;var e=new Date;return(e-this.date)/1e3},this.timeDead=function(){if(!this.dead)return 0;var e=new Date;return(e-this.dead)/1e3},this.xhr=this._newXHR()},Strophe.Request.prototype={getResponse:function(){var e=null;if(this.xhr.responseXML&&this.xhr.responseXML.documentElement){if(e=this.xhr.responseXML.documentElement,"parsererror"==e.tagName)throw Strophe.error("invalid response received"),Strophe.error("responseText: "+this.xhr.responseText),Strophe.error("responseXML: "+Strophe.serialize(this.xhr.responseXML)),"parsererror"}else this.xhr.responseText&&(Strophe.error("invalid response received"),Strophe.error("responseText: "+this.xhr.responseText),Strophe.error("responseXML: "+Strophe.serialize(this.xhr.responseXML)));return e},_newXHR:function(){var e=null;return window.XMLHttpRequest?(e=new XMLHttpRequest,e.overrideMimeType&&e.overrideMimeType("text/xml")):window.ActiveXObject&&(e=new ActiveXObject("Microsoft.XMLHTTP")),e.onreadystatechange=this.func.bind(null,this),e}},Strophe.Bosh=function(e){this._conn=e,this.rid=Math.floor(4294967295*Math.random()),this.sid=null,this.hold=1,this.wait=60,this.window=5,this._requests=[]},Strophe.Bosh.prototype={strip:null,_buildBody:function(){var e=$build("body",{rid:this.rid++,xmlns:Strophe.NS.HTTPBIND});return null!==this.sid&&e.attrs({sid:this.sid}),e},_reset:function(){this.rid=Math.floor(4294967295*Math.random()),this.sid=null},_connect:function(e,t,n){this.wait=e||this.wait,this.hold=t||this.hold;var i=this._buildBody().attrs({to:this._conn.domain,"xml:lang":"en",wait:this.wait,hold:this.hold,content:"text/xml; charset=utf-8",ver:"1.6","xmpp:version":"1.0","xmlns:xmpp":Strophe.NS.BOSH});n&&i.attrs({route:n});var o=this._conn._connect_cb;this._requests.push(new Strophe.Request(i.tree(),this._onRequestStateChange.bind(this,o.bind(this._conn)),i.tree().getAttribute("rid"))),this._throttledRequestHandler()},_attach:function(e,t,n,i,o,s,r){this._conn.jid=e,this.sid=t,this.rid=n,this._conn.connect_callback=i,this._conn.domain=Strophe.getDomainFromJid(this._conn.jid),this._conn.authenticated=!0,this._conn.connected=!0,this.wait=o||this.wait,this.hold=s||this.hold,this.window=r||this.window,this._conn._changeConnectStatus(Strophe.Status.ATTACHED,null)},_connect_cb:function(e){var t,n,i=e.getAttribute("type");if(null!==i&&"terminate"==i)return Strophe.error("BOSH-Connection failed: "+t),t=e.getAttribute("condition"),n=e.getElementsByTagName("conflict"),null!==t?("remote-stream-error"==t&&n.length>0&&(t="conflict"),this._conn._changeConnectStatus(Strophe.Status.CONNFAIL,t)):this._conn._changeConnectStatus(Strophe.Status.CONNFAIL,"unknown"),this._conn._doDisconnect(),Strophe.Status.CONNFAIL;this.sid||(this.sid=e.getAttribute("sid"));var o=e.getAttribute("requests");o&&(this.window=parseInt(o,10));var s=e.getAttribute("hold");s&&(this.hold=parseInt(s,10));var r=e.getAttribute("wait");r&&(this.wait=parseInt(r,10))},_disconnect:function(e){this._sendTerminate(e)},_doDisconnect:function(){this.sid=null,this.rid=Math.floor(4294967295*Math.random())},_emptyQueue:function(){return 0===this._requests.length},_hitError:function(e){this.errors++,Strophe.warn("request errored, status: "+e+", number of errors: "+this.errors),this.errors>4&&this._onDisconnectTimeout()},_no_auth_received:function(e){e=e?e.bind(this._conn):this._conn._connect_cb.bind(this._conn);var t=this._buildBody();this._requests.push(new Strophe.Request(t.tree(),this._onRequestStateChange.bind(this,e.bind(this._conn)),t.tree().getAttribute("rid"))),this._throttledRequestHandler()},_onDisconnectTimeout:function(){for(var e;this._requests.length>0;)e=this._requests.pop(),e.abort=!0,e.xhr.abort(),e.xhr.onreadystatechange=function(){}},_onIdle:function(){var e=this._conn._data;if(this._conn.authenticated&&0===this._requests.length&&0===e.length&&!this._conn.disconnecting&&(Strophe.info("no requests during idle cycle, sending blank request"),e.push(null)),this._requests.length<2&&e.length>0&&!this._conn.paused){for(var t=this._buildBody(),n=0;n<e.length;n++)null!==e[n]&&("restart"===e[n]?t.attrs({to:this._conn.domain,"xml:lang":"en","xmpp:restart":"true","xmlns:xmpp":Strophe.NS.BOSH}):t.cnode(e[n]).up());delete this._conn._data,this._conn._data=[],this._requests.push(new Strophe.Request(t.tree(),this._onRequestStateChange.bind(this,this._conn._dataRecv.bind(this._conn)),t.tree().getAttribute("rid"))),this._processRequest(this._requests.length-1)}if(this._requests.length>0){var i=this._requests[0].age();null!==this._requests[0].dead&&this._requests[0].timeDead()>Math.floor(Strophe.SECONDARY_TIMEOUT*this.wait)&&this._throttledRequestHandler(),i>Math.floor(Strophe.TIMEOUT*this.wait)&&(Strophe.warn("Request "+this._requests[0].id+" timed out, over "+Math.floor(Strophe.TIMEOUT*this.wait)+" seconds since last activity"),this._throttledRequestHandler())}},_onRequestStateChange:function(e,t){if(Strophe.debug("request id "+t.id+"."+t.sends+" state changed to "+t.xhr.readyState),t.abort)return void(t.abort=!1);var n;if(4==t.xhr.readyState){n=0;try{n=t.xhr.status}catch(i){}if("undefined"==typeof n&&(n=0),this.disconnecting&&n>=400)return void this._hitError(n);var o=this._requests[0]==t,s=this._requests[1]==t;(n>0&&500>n||t.sends>5)&&(this._removeRequest(t),Strophe.debug("request id "+t.id+" should now be removed")),200==n?((s||o&&this._requests.length>0&&this._requests[0].age()>Math.floor(Strophe.SECONDARY_TIMEOUT*this.wait))&&this._restartRequest(0),Strophe.debug("request id "+t.id+"."+t.sends+" got 200"),e(t),this.errors=0):(Strophe.error("request id "+t.id+"."+t.sends+" error "+n+" happened"),(0===n||n>=400&&600>n||n>=12e3)&&(this._hitError(n),n>=400&&500>n&&(this._conn._changeConnectStatus(Strophe.Status.DISCONNECTING,null),this._conn._doDisconnect()))),n>0&&500>n||t.sends>5||this._throttledRequestHandler()}},_processRequest:function(e){var t=this,n=this._requests[e],i=-1;try{4==n.xhr.readyState&&(i=n.xhr.status)}catch(o){Strophe.error("caught an error in _requests["+e+"], reqStatus: "+i)}if("undefined"==typeof i&&(i=-1),n.sends>this.maxRetries)return void this._onDisconnectTimeout();var s=n.age(),r=!isNaN(s)&&s>Math.floor(Strophe.TIMEOUT*this.wait),a=null!==n.dead&&n.timeDead()>Math.floor(Strophe.SECONDARY_TIMEOUT*this.wait),l=4==n.xhr.readyState&&(1>i||i>=500);if((r||a||l)&&(a&&Strophe.error("Request "+this._requests[e].id+" timed out (secondary), restarting"),n.abort=!0,n.xhr.abort(),n.xhr.onreadystatechange=function(){},this._requests[e]=new Strophe.Request(n.xmlData,n.origFunc,n.rid,n.sends),n=this._requests[e]),0===n.xhr.readyState){Strophe.debug("request id "+n.id+"."+n.sends+" posting");try{n.xhr.open("POST",this._conn.service,this._conn.options.sync?!1:!0)}catch(h){return Strophe.error("XHR open failed."),this._conn.connected||this._conn._changeConnectStatus(Strophe.Status.CONNFAIL,"bad-service"),void this._conn.disconnect()}var c=function(){if(n.date=new Date,t._conn.options.customHeaders){var e=t._conn.options.customHeaders;for(var i in e)e.hasOwnProperty(i)&&n.xhr.setRequestHeader(i,e[i])}n.xhr.send(n.data)};if(n.sends>1){var d=1e3*Math.min(Math.floor(Strophe.TIMEOUT*this.wait),Math.pow(n.sends,3));setTimeout(c,d)}else 0==n.sends&&c();n.sends++,this._conn.xmlOutput!==Strophe.Connection.prototype.xmlOutput&&(n.xmlData.nodeName===this.strip&&n.xmlData.childNodes.length?this._conn.xmlOutput(n.xmlData.childNodes[0]):this._conn.xmlOutput(n.xmlData)),this._conn.rawOutput!==Strophe.Connection.prototype.rawOutput&&this._conn.rawOutput(n.data)}else Strophe.debug("_processRequest: "+(0===e?"first":"second")+" request has readyState of "+n.xhr.readyState)},_removeRequest:function(e){Strophe.debug("removing request");var t;for(t=this._requests.length-1;t>=0;t--)e==this._requests[t]&&this._requests.splice(t,1);e.xhr.onreadystatechange=function(){},this._throttledRequestHandler()},_restartRequest:function(e){var t=this._requests[e];null===t.dead&&(t.dead=new Date),this._processRequest(e)},_reqToData:function(e){try{return e.getResponse()}catch(t){if("parsererror"!=t)throw t;this._conn.disconnect("strophe-parsererror")}},_sendTerminate:function(e){Strophe.info("_sendTerminate was called");var t=this._buildBody().attrs({type:"terminate"});e&&t.cnode(e.tree());var n=new Strophe.Request(t.tree(),this._onRequestStateChange.bind(this,this._conn._dataRecv.bind(this._conn)),t.tree().getAttribute("rid"));this._requests.push(n),this._throttledRequestHandler()},_send:function(){clearTimeout(this._conn._idleTimeout),this._throttledRequestHandler(),this._conn._idleTimeout=setTimeout(this._conn._onIdle.bind(this._conn),100)},_sendRestart:function(){this._throttledRequestHandler(),clearTimeout(this._conn._idleTimeout)},_throttledRequestHandler:function(){this._requests?Strophe.debug("_throttledRequestHandler called with "+this._requests.length+" requests"):Strophe.debug("_throttledRequestHandler called with undefined requests"),this._requests&&0!==this._requests.length&&(this._requests.length>0&&this._processRequest(0),this._requests.length>1&&Math.abs(this._requests[0].rid-this._requests[1].rid)<this.window&&this._processRequest(1))}},Strophe.Websocket=function(e){this._conn=e,this.strip="stream:stream";var t=e.service;if(0!==t.indexOf("ws:")&&0!==t.indexOf("wss:")){var n="";n+="ws"===e.options.protocol&&"https:"!==window.location.protocol?"ws":"wss",n+="://"+window.location.host,n+=0!==t.indexOf("/")?window.location.pathname+t:t,e.service=n}},Strophe.Websocket.prototype={_buildStream:function(){return $build("stream:stream",{to:this._conn.domain,xmlns:Strophe.NS.CLIENT,"xmlns:stream":Strophe.NS.STREAM,version:"1.0"})},_check_streamerror:function(e,t){var n=e.getElementsByTagName("stream:error");if(0===n.length)return!1;for(var i=n[0],o="",s="",r="urn:ietf:params:xml:ns:xmpp-streams",a=0;a<i.childNodes.length;a++){var l=i.childNodes[a];if(l.getAttribute("xmlns")!==r)break;"text"===l.nodeName?s=l.textContent:o=l.nodeName}var h="WebSocket stream error: ";return h+=o?o:"unknown",s&&(h+=" - "+o),Strophe.error(h),this._conn._changeConnectStatus(t,o),this._conn._doDisconnect(),!0},_reset:function(){},_connect:function(){this._closeSocket(),this.socket=new WebSocket(this._conn.service,"xmpp"),this.socket.onopen=this._onOpen.bind(this),this.socket.onerror=this._onError.bind(this),this.socket.onclose=this._onClose.bind(this),this.socket.onmessage=this._connect_cb_wrapper.bind(this)},_connect_cb:function(e){var t=this._check_streamerror(e,Strophe.Status.CONNFAIL);return t?Strophe.Status.CONNFAIL:void 0},_handleStreamStart:function(e){var t=!1,n=e.getAttribute("xmlns");"string"!=typeof n?t="Missing xmlns in stream:stream":n!==Strophe.NS.CLIENT&&(t="Wrong xmlns in stream:stream: "+n);var i=e.namespaceURI;"string"!=typeof i?t="Missing xmlns:stream in stream:stream":i!==Strophe.NS.STREAM&&(t="Wrong xmlns:stream in stream:stream: "+i);var o=e.getAttribute("version");return"string"!=typeof o?t="Missing version in stream:stream":"1.0"!==o&&(t="Wrong version in stream:stream: "+o),t?(this._conn._changeConnectStatus(Strophe.Status.CONNFAIL,t),this._conn._doDisconnect(),!1):!0},_connect_cb_wrapper:function(e){if(0===e.data.indexOf("<stream:stream ")||0===e.data.indexOf("<?xml")){var t=e.data.replace(/^(<\?.*?\?>\s*)*/,"");if(""===t)return;t=e.data.replace(/<stream:stream (.*[^\/])>/,"<stream:stream $1/>");var n=(new DOMParser).parseFromString(t,"text/xml").documentElement;this._conn.xmlInput(n),this._conn.rawInput(e.data),this._handleStreamStart(n)&&(this._connect_cb(n),this.streamStart=e.data.replace(/^<stream:(.*)\/>$/,"<stream:$1>"))}else{if("</stream:stream>"===e.data)return this._conn.rawInput(e.data),this._conn.xmlInput(document.createElement("stream:stream")),this._conn._changeConnectStatus(Strophe.Status.CONNFAIL,"Received closing stream"),void this._conn._doDisconnect();var i=this._streamWrap(e.data),o=(new DOMParser).parseFromString(i,"text/xml").documentElement;this.socket.onmessage=this._onMessage.bind(this),this._conn._connect_cb(o,null,e.data)}},_disconnect:function(e){if(this.socket.readyState!==WebSocket.CLOSED){e&&this._conn.send(e);var t="</stream:stream>";this._conn.xmlOutput(document.createElement("stream:stream")),this._conn.rawOutput(t);try{this.socket.send(t)}catch(n){Strophe.info("Couldn't send closing stream tag.")}}this._conn._doDisconnect()},_doDisconnect:function(){Strophe.info("WebSockets _doDisconnect was called"),this._closeSocket()},_streamWrap:function(e){return this.streamStart+e+"</stream:stream>"},_closeSocket:function(){if(this.socket)try{this.socket.close()}catch(e){}this.socket=null},_emptyQueue:function(){return!0},_onClose:function(){this._conn.connected&&!this._conn.disconnecting?(Strophe.error("Websocket closed unexcectedly"),this._conn._doDisconnect()):Strophe.info("Websocket closed")},_no_auth_received:function(e){Strophe.error("Server did not send any auth methods"),this._conn._changeConnectStatus(Strophe.Status.CONNFAIL,"Server did not send any auth methods"),e&&(e=e.bind(this._conn))(),this._conn._doDisconnect()},_onDisconnectTimeout:function(){},_onError:function(e){Strophe.error("Websocket error "+e),this._conn._changeConnectStatus(Strophe.Status.CONNFAIL,"The WebSocket connection could not be established was disconnected."),this._disconnect()},_onIdle:function(){var e=this._conn._data;if(e.length>0&&!this._conn.paused){for(var t=0;t<e.length;t++)if(null!==e[t]){var n,i;"restart"===e[t]?(n=this._buildStream(),i=this._removeClosingTag(n),n=n.tree()):(n=e[t],i=Strophe.serialize(n)),this._conn.xmlOutput(n),this._conn.rawOutput(i),this.socket.send(i)}this._conn._data=[]}},_onMessage:function(e){var t,n;if("</stream:stream>"===e.data){var i="</stream:stream>";return this._conn.rawInput(i),this._conn.xmlInput(document.createElement("stream:stream")),void(this._conn.disconnecting||this._conn._doDisconnect())}if(0===e.data.search("<stream:stream ")){if(n=e.data.replace(/<stream:stream (.*[^\/])>/,"<stream:stream $1/>"),t=(new DOMParser).parseFromString(n,"text/xml").documentElement,!this._handleStreamStart(t))return}else n=this._streamWrap(e.data),t=(new DOMParser).parseFromString(n,"text/xml").documentElement;if(!this._check_streamerror(t,Strophe.Status.ERROR))return this._conn.disconnecting&&"presence"===t.firstChild.nodeName&&"unavailable"===t.firstChild.getAttribute("type")?(this._conn.xmlInput(t),void this._conn.rawInput(Strophe.serialize(t))):void this._conn._dataRecv(t,e.data)},_onOpen:function(){Strophe.info("Websocket open");var e=this._buildStream();this._conn.xmlOutput(e.tree());var t=this._removeClosingTag(e);this._conn.rawOutput(t),this.socket.send(t)},_removeClosingTag:function(e){var t=Strophe.serialize(e);return t=t.replace(/<(stream:stream .*[^\/])\/>$/,"<$1>")},_reqToData:function(e){return e},_send:function(){this._conn.flush()},_sendRestart:function(){clearTimeout(this._conn._idleTimeout),this._conn._onIdle.bind(this._conn)()}},Strophe.addConnectionPlugin("muc",{init:function(e){this.connection=e,Strophe.addNamespace("MUC_OWNER",Strophe.NS.MUC+"#owner"),Strophe.addNamespace("MUC_ADMIN",Strophe.NS.MUC+"#admin"),Strophe.addNamespace("MUC_USER",Strophe.NS.MUC+"#user"),this.connection.addHandler(this.handleMucInvite.bind(this),Strophe.NS.MUC_USER,"message"),this.connection.addHandler(this.handleMucMessage.bind(this),null,"message","groupchat"),this.connection.addHandler(this.handleMucPresence.bind(this),Strophe.NS.MUC_USER,"presence")},handleMucInvite:function(e){var t,n=$(e).find('x[xmlns="'+Strophe.NS.MUC_USER+'"] > invite');return n.length&&(t={room:$(e).attr("from"),reason:$(e).find("reason").text(),body:$(e).find("body").text(),from:$(e).find("invite").attr("from")},$(document).trigger("inviteReceived.muc",t)),!0},handleMucMessage:function(e){var t,n=$(e),i=n.find("subject");return i.length&&i.each(function(){var e={topic:$(this).text(),room:n.attr("from").split("/")[0]};$(document).trigger("topicReceived.muc",e)}),n.find("> body").text()&&(t={room:n.attr("from").split("/")[0],nick:n.attr("from").split("/")[1],body:n.find("> body").text(),html_body:n.find('html[xmlns="http://jabber.org/protocol/xhtml-im"] > body').html(),delay:n.find("delay").attr("stamp")||null},$(document).trigger("messageReceived.muc",t)),!0},handleMucPresence:function(e){var t,n,i=$(e);return n=i.find('x[xmlns="'+Strophe.NS.MUC_USER+'"] > item[affiliation][role]'),t={room:i.attr("from").split("/")[0],nick:i.attr("from").split("/")[1],status:i.attr("type")||"available",show:i.find("show").text()||"",role:n.attr("role"),affiliation:n.attr("affiliation"),jid:n.attr("jid")||""},$(document).trigger("presenceReceived.muc",t),!0},join:function(e,t,n){var i,o;i=e+"/"+t,o=$pres({from:this.connection.jid,to:i}),n&&o.c("show").t(n).up().c("x",{xmlns:Strophe.NS.MUC}),this.connection.send(o)},leave:function(e,t){var n=$pres({type:"unavailable",from:this.connection.jid,to:e}).c("x",{xmlns:Strophe.NS.MUC});this.connection.send(n)},message:function(e,t,n){var i,o;i=this.connection.getUniqueId(),o=$msg({to:e,from:this.connection.jid.split("/")[0]+"/"+t,type:"groupchat",id:i}).c("body").t(n),this.connection.send(o)},setTopic:function(e,t){var n=$msg({to:e,from:this.connection.jid,type:"groupchat"}).c("subject",{xmlns:"jabber:client"}).t(t);this.connection.send(n.tree())},inviteUser:function(e,t,n,i){var o=$msg({from:t,to:e}).c("x",{xmlns:Strophe.NS.MUC_USER}).c("invite",{to:n});i&&(o=o.c("reason").t(i)),this.connection.send(o.tree())}}),Strophe.addConnectionPlugin("presence",{init:function(e){this.connection=e},online:function(){this.connection.send($pres())},offline:function(){this.connection.send($pres({type:"unavailable"}))}});var Ktalk=function(e,t){function n(){var e=jQuery(".footer-ads-block").css("display");"undefined"!=typeof e&&"block"===e&&jQuery("#ktalk_live_help_icon").addClass("hidden-phone"),jQuery(".close-btn").click(function(){jQuery("#ktalk_live_help_icon").removeClass("hidden-phone")})}function i(){var e=jQuery(".footer-ads-block").css("display");"undefined"!=typeof e&&"block"===e&&jQuery(".footer-ads-block").css("display","none")}function o(){ce();var e=m.speclialist_jid;D(e,"Customer has ended conversation.",m.session.session_id),setTimeout(function(){m.connection.disconnect()},5e3),G()}this.connection=null,this.username=e,this.jabber_id=null,this.password=null,this.session=null,this.type="undefined"==typeof t?1:t;var s,r,a,l,h,c,d=!1,u=d;d?(s="https:"===location.protocol?"https://tigase3.konga.com:5281/http-bind":"http://tigase3.konga.com:5280/http-bind",r="tigase3.konga.com",a="muc@tigase3.konga.com",l="https://livehelp.konga.com",c="http://am.konga.com/api/",h="http://stagingshqmw.konga.com/"):(s="https:"===location.protocol?"https://comm.igbimo.com:5281/http-bind":"http://comm.igbimo.com:5280/http-bind",r="comm.igbimo.com",a="muc@comm.igbimo.com",l="https://khelp.igbimo.com",c="http://am.konga.com/api/",h="http://sellerhqmw.konga.com/");var _=3e5,p={chat_tone_url:"https://s3.amazonaws.com/www.konga.com/system/spree/ktalk/chat.mp3",ajax_loader:"https://images.konga.com/v2/s3.amazonaws.com/www.konga.com/system/spree/ktalk/talkToSpecialists.gif",ktalk_popup_row:".ktalk_popup_row",live_help_top:300,live_help_left:0,live_help_bottom:0,ktalk_live_help_overlay:"#ktalk_live_help_overlay",ktalk_live_help_form:"#ktalk_live_help_form",ktalk_live_help_fullname:"#ktalk_live_help_fullname",ktalk_live_help_question:"#ktalk_live_help_question",ktalk_live_help_email:"#ktalk_live_help_email",ktalk_live_help_form_btn:"#ktalk_live_help_form_btn",ktalk_live_help_close_btn:"#ktalk_live_help_close_btn",ktalk_live_help:"#ktalk_live_help",ktalk_live_help_chat_header:"#ktalk_live_help_chat_header",ktalk_live_help_msg_container:"#ktalk_live_help_msg_container",ktalk_live_help_bottom:"#ktalk_live_help_bottom",ktalk_live_help_question_display:"#ktalk_live_help_question_display",ktalk_live_help_message_box:"#ktalk_live_help_message_box",staging_track_my_order:"http://staging.konga.vaimo.com/sales/guest/form",staging_how_to_sell:"http://staging.konga.vaimo.com/howtosell",live_track_my_order:"http://konga.com/sales/guest/form",live_how_to_sell:"http://skonga.com/howtosell",ktalk_live_help_email_required:"#ktalk_live_help_email_required",ktalk_live_help_fullname_required:"#ktalk_live_help_fullname_required",ktalk_live_help_question_required:"#ktalk_live_help_question_required",ktalk_link_help_cookie_open:"ktalk_link_help_cookie_open",ktalk_link_help_cookie_room:"ktalk_link_help_cookie_room",ktalk_link_help_cookie_title:"ktalk_link_help_cookie_title",rooms:{elect_specialist:"Electronics Expert",mp_specialist:"Marketplace Specialist",konga_help:"Customer Service"},ktalk_live_help_title:"#ktalk_live_help_title",ktalk_live_help_session:"ktalk_live_help_session",ktalk_live_help_in_progress:"ktalk_live_help_in_progress",ktalk_live_help_notice:"#ktalk_live_help_notice",ktalk_live_help_notice_btn:"#ktalk_live_help_notice_btn",ktalk_live_help_notice_count_down:"#ktalk_live_help_notice_count_down",ktalk_live_help_close_container:"#ktalk_live_help_close_container",ktalk_live_help_close_container_yes_btn:"#ktalk_live_help_close_container_yes_btn",ktalk_live_help_close_container_no_btn:"#ktalk_live_help_close_container_no_btn",ktalk_live_help_start_hours:8,ktalk_live_help_end_hours:17,ktalk_live_help_body_wrapper:"#ktalk_live_help_body_wrapper",ktalk_live_help_typing:"#ktalk_live_help_typing"},m=this,f=null,g=null,v={getBareJabberId:function(e){return e+"@"+r},getTitleFromRoom:function(e){return p.rooms[e]}},k={userChatTemplate:function(e,t,n,i){var o="<div style='border-bottom:1px solid #f6f6f6; min-height:40px; padding:10px 7px;'>                <span style='color:#325d88; font-family:Verdana, Geneva, sans-serif;font-size:11px; float:left; padding-bottom:3px;'>{{name}}</span>                <span class='ktalk_popup_row' time='{{raw_time}}' style='color:#999; font-family:Verdana, Geneva, sans-serif;font-size:10px; float:right; padding-bottom:3px;padding-right:4px;'>{{time}}</span>                <div style='clear: both;'></div>                <span style='color:#000; font-family:Verdana, Geneva, sans-serif;word-wrap:break-word;font-size:11px;'>{{msg}}</span>            </div>";return o=o.replace("{{name}}",e).replace("{{time}}",t.toRelativeTime(1e3)).replace("{{msg}}",n).replace("{{raw_time}}",t.toString())},recipientChatTemplate:function(e,t,n,i){var o="<div style='border-bottom:1px solid #f6f6f6; min-height:40px; padding:10px 7px;'>                <span style='color:#f9a026; font-family:Verdana, Geneva, sans-serif;font-size:11px; float:left; padding-bottom:3px; padding-top:3px;'>{{name}}</span>                <span class='ktalk_popup_row' time='{{raw_time}}' style='color:#999; font-family:Verdana, Geneva, sans-serif;font-size:10px; float:right; padding-bottom:3px;padding-right:4px;'>{{time}}</span>                <div style='clear: both;'></div>                <span style='color:#000; font-family:Verdana, Geneva, sans-serif;font-size:11px;word-wrap:break-word;'>{{msg}}</span>            </div>";return o=o.replace("{{name}}",e).replace("{{time}}",t.toRelativeTime()).replace("{{msg}}",n).replace("{{raw_time}}",t.toString())}},y=function(){var e=jQuery(p.ktalk_live_help_body_wrapper);e.is(":visible")?jQuery("#ktalk_live_help_header").html("&#x2751;"):jQuery("#ktalk_live_help_header").html("&minus;"),e.slideToggle("fast"),S()},b=function(e,t){var n="Me",i="12345";e=K(e),jQuery(p.ktalk_live_help_msg_container).append(k.userChatTemplate(n,t,e,i)),S()},x=function(e,t){var n=E(p.ktalk_link_help_cookie_title),i="12345";e=K(e),jQuery(p.ktalk_live_help_msg_container).append(k.recipientChatTemplate(n,t,e,i)),S()},S=function(){jQuery(p.ktalk_live_help_msg_container).animate({scrollTop:jQuery(p.ktalk_live_help_msg_container)[0].scrollHeight},"fast")},w=function(){jQuery(p.ktalk_live_help_typing).show()},T=function(){jQuery(p.ktalk_live_help_typing).hide()},N=function(){jQuery(p.ktalk_popup_row).each(function(e,t){var n,i=jQuery(t),o=i.attr("time"),s=new Date(o);n=s.getDate()==(new Date).getDate()?s.toRelativeTime(5e3):s.toDateString(),i.html(n)})},C=function(e,t,n,i,o,a){m.name=e,m.email=t,m.product=n,m.question=i,m.connection=new Strophe.Connection(s),m.room=o,m.t_uname="Konga Specialist",m.isContinue=a,m.connection.connect(r,null,A),u&&(m.connection.rawInput=function(e){console.log("RECV: "+e)},m.connection.rawOutput=function(e){console.log("SEND: "+e)}),f=new Audio(p.chat_tone_url),g=new Image,g.src=p.ajax_loader,g.style.width="230px"},A=function(e){if(e==Strophe.Status.CONNECTING)u&&console.log("Live Desk is connecting.");else if(e==Strophe.Status.CONNFAIL)u&&console.log("Live Desk failed to connect.");else if(e==Strophe.Status.DISCONNECTING)u&&console.log("Live Desk is disconnecting.");else if(e==Strophe.Status.DISCONNECTED)u&&console.log("Live Desk is disconnected.");else if(e==Strophe.Status.CONNECTED){if(u&&console.log("Live Desk is connected."),m.isContinue)j();else{var t=m.connection.jid.split("/")[0];Z(m.email,m.name,m.question,t)}m.connection.addHandler(I,null,"message",null,null,null)}},I=function(e){var t=(e.getAttribute("to"),e.getAttribute("from")),n=e.getAttribute("type"),i=e.getElementsByTagName("body"),o=e.getElementsByTagName("composing"),s=e.getElementsByTagName("paused"),r=(e.getElementsByTagName("received"),e.getElementsByTagName("request"),e.getAttribute("id")),a=e.getAttribute("email"),l=e.getAttribute("session_id");if("chat"==n){if(i.length>0){var h=i[0],c=Strophe.getText(h),d=new Date,u=E(p.ktalk_link_help_cookie_title);Y(c,d),x(Strophe.getText(h),new Date),f.play(),N()}o.length>0?w():T(),s.length>0&&T()}else if("notify"==n){m.speclialist_jid=t,m.connection.presence.offline(),j(),G(),H(p.ktalk_live_help_in_progress,!0,"/");var u=E(p.ktalk_link_help_cookie_title);
m.session=new J(l,t,u,m.question),te();var c="Hello "+m.name+" How may I help you?",d=new Date,_=localStorage.getItem("ktalk_help_customer_id");localStorage.setItem("ktalk_help_staff_email",a),ee(_,a,t),Y(c,d,!1),x(c,d),f.play(),N()}else if("transfer"==n){m.speclialist_jid=t,m.connection.presence.online(),m.room=r,M(m.room,m.customerId,!0);var g=v.getTitleFromRoom(m.room);jQuery(p.ktalk_live_help_title).html(g),H(p.ktalk_link_help_cookie_room,m.room,1,"/"),H(p.ktalk_link_help_cookie_title,g,1,"/");var c="You are have been transfered to "+g+"...",d=new Date,u=E(p.ktalk_link_help_cookie_title);Y(c,d),x(c,d),f.play(),N()}else if("end"==n){if(i.length>0){var h=i[0],c=Strophe.getText(h),d=new Date,u=E(p.ktalk_link_help_cookie_title);Y(c,d),x(Strophe.getText(h),new Date),f.play(),N(),jQuery(p.ktalk_live_help_message_box).attr("disabled",!0),he(),ce()}}else if(i.length>0)var h=i[0];return!0},j=function(){jQuery(p.ktalk_live_help_form).hide(),jQuery(p.ktalk_live_help_chat_header).show(),jQuery(p.ktalk_live_help_msg_container).show(),jQuery(p.ktalk_live_help_bottom).show(),jQuery(p.ktalk_live_help_question_display).html(m.question),jQuery(p.ktalk_live_help_message_box).elastic(),jQuery(p.ktalk_live_help_message_box).trigger("update")},q=function(e){return parts=e.split("@"),parts.length<2?!1:(first_part=parts[0],second_part=parts[1],regex_firstpart=/^[0-9a-zA-Z][a-zA-Z0-9_.-]*$/,regex_secondpart=/^[a-zA-Z_-]+[.][a-zA-Z_-]+([.][a-zA-Z_-]+)?$/,regex_firstpart.test(first_part)&&regex_secondpart.test(second_part)?!0:!1)},D=function(e,t,n){var i=localStorage.getItem("ktalk_help_customer_id");"undefined"!=typeof i&&(_customerServerId=i);var o=$msg({to:e,type:"chat",session_id:n,customer_server_id:_customerServerId}).cnode(Strophe.xmlElement("body",t));m.connection.send(o)},M=function(e,t,n){m.connection.muc.join(e+"@muc."+r,t,n)},E=function(e){var t=document.cookie.indexOf(e+"="),n=t+e.length+1;if(!t&&e!=document.cookie.substring(0,e.length))return null;if(-1==t)return null;var i=document.cookie.indexOf(";",n);return-1==i&&(i=document.cookie.length),unescape(document.cookie.substring(n,i))},H=function(e,t,n,i,o,s){var r=new Date;r.setTime(r.getTime()),n&&(n=1e3*n*60*60*24);var a=new Date(r.getTime()+n);document.cookie=e+"="+escape(t)+(n?";expires="+a.toGMTString():"")+(i?";path="+i:"")+(o?";domain="+o:"")+(s?";secure":"")},O=function(e,t,n){E(e)&&(document.cookie=e+"="+(t?";path="+t:"")+(n?";domain="+n:"")+";expires=Thu, 01-Jan-1970 00:00:01 GMT")},L=function(e,t){var i=new Image;i.id="ktalk_live_help_icon",i.src="//s3.amazonaws.com/www_konga_com/ktalk/images/liveHelp-01-new.png?scale_mode=aspect_fit&w=140",i.style.cursor="pointer",i.style.zIndex=9500,i.style.position="fixed",i.style.height="118px",i.style.bottom="10px",i.style.right=t+"px",i.onclick=function(){R();var e=jQuery(p.ktalk_live_help_overlay);e.is(":visible")?(e.fadeOut(),jQuery(".ktalk_live_help_popout").hide()):(e.toggle(),jQuery(".ktalk_live_help_popout").each(function(e,t){var n=t.style.left.split("p")[0],i=jQuery(t);i.show()}))},jQuery("body").append(i),n()},R=function(){for(var e=document.getElementById("ktalk_live_help_icon").className.split(/\s+/),t=0;t<e.length;t++)"hidden-phone"===e[t]&&jQuery("#ktalk_live_help_icon").removeClass("hidden-phone");i()},Q=function(){var e=document.createElement("div");e.id="ktalk_live_help_overlay",e.onclick=function(){this.style.display="none",jQuery(".ktalk_live_help_popout").fadeToggle()},e.style.display="none",e.style.backgroundColor="#000",e.style.opacity=.4,e.style.width="100%",e.style.height="100%",e.style.position="fixed",e.style.top=0,e.style.zIndex=9e3,jQuery("body").append(e)},z=function(e,t,n,i){var o,s=document.createElement("div"),r=e,a=t;r-=23,a+=65,o=10,s.className="ktalk_live_help_popout",s.style.borderRadius="10px",s.style.display="none",s.style.cursor="pointer",s.style.position="fixed",s.style.bottom=o+"px",s.style.left="inherit !important",s.style.right=a+"px",s.style.fontSize="14px",s.style.color="#325d88",s.style.fontFamily="sans-serif",s.style.padding="5px 20px",s.style.backgroundColor="#d6d3d3",s.style.border="4px solid #fff",s.style.zIndex="9500",s.style.width="190px",s.style.textAlign="center";var l=document.createTextNode(n);s.appendChild(l),jQuery("body").append(s)},F=function(e,t,n,i,o,s){var r,a=document.createElement("div"),l=e,h=t,c="";switch("undefined"!=typeof s&&(a.id=s),n){case 1:l-=23,h+=102,r=85,c="konga_help";break;case 2:l+=20,h+=115,r=45,c="konga_help";break;case 3:l+=60,r=5,h+=110,c="konga_help"}a.className="ktalk_live_help_popout",a.style.borderRadius="10px",a.style.display="none",a.style.cursor="pointer",a.style.position="fixed",a.style.bottom=r+"px",a.style.right=h+"px",a.style.left="inherit !important",a.style.fontSize="14px",a.style.color="#325d88",a.style.fontFamily="sans-serif",a.style.padding="5px 20px",a.style.backgroundColor="#d6d3d3",a.style.border="4px solid #fff",a.style.zIndex="9500",a.onclick=function(){if(jQuery(p.ktalk_live_help).is(":visible")){var e=jQuery(p.ktalk_live_help).attr("room");c!=e&&(jQuery(p.ktalk_live_help_close_btn).click(),X(c,o,!1)),jQuery(p.ktalk_live_help_overlay).click()}else X(c,o,!1),jQuery(p.ktalk_live_help_overlay).click()},a.onmouseover=function(){this.style.background="#325d88",this.style.color="#fff"},a.onmouseout=function(){this.style.background="#d6d3d3",this.style.color="#325d88"};var d=document.createTextNode(i);a.appendChild(d),jQuery("body").append(a)},B=function(e){if(L(p.live_help_top,p.live_help_left),Q(),e)F(p.live_help_top,p.live_help_left,1,"Chat with an Electronics Expert","Electronics Expert","ktalk_live_help_popout_electronics_expert"),F(p.live_help_top,p.live_help_left,2,"How do I sell on Konga?","Mall Expert","ktalk_live_help_popout_mall_expert"),F(p.live_help_top,p.live_help_left,3,"Chat with Customer Service","Customer Service","ktalk_live_help_popout_customer_service"),jQuery("body").on("click",p.ktalk_live_help_form_btn,function(){var e=jQuery(p.ktalk_live_help_fullname).val().trim(),t=jQuery(p.ktalk_live_help_email).val().trim(),n=jQuery(p.ktalk_live_help_question).val().trim(),i=jQuery(p.ktalk_live_help).attr("room"),o="home-page";if("undefined"!=typeof dataLayer&&dataLayer[2].pageName){var s=dataLayer[2].pageName;switch(s){case"home-page":o="Home Page";break;case"category-page":o=dataLayer[2].categoryName;break;case"product-detail-page":o=dataLayer[2].productId;break;default:o=s}}jQuery(p.ktalk_live_help_fullname_required).hide(),jQuery(p.ktalk_live_help_email_required).hide(),jQuery(p.ktalk_live_help_question_required).hide();var r=!0;e.length<1&&(jQuery(p.ktalk_live_help_fullname_required).show(),r=!1),(t.length<1||!q(t))&&(r=!1,jQuery(p.ktalk_live_help_email_required).show()),n.length<1&&(r=!1,jQuery(p.ktalk_live_help_question_required).show()),r&&(C(e,t,o,n,i,!1),H(p.ktalk_link_help_cookie_room,m.room,1,"/"),U())}),jQuery("body").on("click",p.ktalk_live_help_close_btn,function(e){he(),jQuery(p.ktalk_live_help_notice).is(":visible")?(jQuery(p.ktalk_live_help).remove(),ce()):jQuery(p.ktalk_live_help_form).is(":visible")||jQuery(p.ktalk_live_help_close_container).is(":visible")?(jQuery(p.ktalk_live_help).remove(),ce()):(jQuery(p.ktalk_live_help_msg_container).hide(),jQuery(p.ktalk_live_help_message_box).attr("disabled",!0),jQuery(p.ktalk_live_help_close_container).fadeIn()),e.stopPropagation()}),jQuery("body").on("click",p.ktalk_live_help_close_container_yes_btn,function(){o(),jQuery(p.ktalk_live_help).remove()}),jQuery("body").on("click",p.ktalk_live_help_close_container_no_btn,function(){jQuery(p.ktalk_live_help_close_container).hide(),jQuery(p.ktalk_live_help_message_box).attr("disabled",!1),jQuery(p.ktalk_live_help_msg_container).fadeIn(),te(!0)}),jQuery("body").on("click",p.ktalk_live_help_notice_btn,function(){jQuery(p.ktalk_live_help_notice).hide(),jQuery(p.ktalk_live_help_message_box).attr("disabled",!1),jQuery(p.ktalk_live_help_msg_container).fadeIn(),clearInterval(m.countDownId),te(!0)}),jQuery("body").on("keyup",p.ktalk_live_help_message_box,function(e){if(te(!0),13==e.keyCode){var t=jQuery(this).val().trim();if(t.length>0){var n=m.speclialist_jid,i=new Date;E(p.ktalk_link_help_cookie_title);Y(t,i,!0),D(n,t,m.session.session_id),b(t,i),N(),jQuery(this).val("")}}return!1}),$();else{var t=new Date("12/26/2016"),n=new Date("01/01/2016"),i=new Date;if(t.setHours(0,0,0,0)==i.setHours(0,0,0,0)){var s="Due to  the Christmas break, our live chat operators would not be available today, You can reach us on the 27th of December by  8:00 AM. Merry Christmas.";z(p.live_help_top,p.live_help_left,s,"Offline")}else if(n.setHours(0,0,0,0)==i.setHours(0,0,0,0)){var r="Due to  the New Year break, our live chat operators would not be available today, You can reach us on the 4th of January. Happy New Year.";z(p.live_help_top,p.live_help_left,r,"Offline")}else{var a="Our Livechat Operator is currently offline. We are available from 8am - 5pm  on Monday - Friday. You can still reach us by sending an email to help@konga.com. Thank you";z(p.live_help_top,p.live_help_left,a,"Offline")}}},U=function(){jQuery(p.ktalk_live_help_form).empty().css("text-align","center").css("font-weight","bold").append("Please wait, while we connect you to a konga specialist.</br></br>").append(g)},X=function(e,t,n){H(p.ktalk_link_help_cookie_open,"true",1,"/"),H(p.ktalk_link_help_cookie_room,e,1,"/"),H(p.ktalk_link_help_cookie_title,t,1,"/");var i="<div room='"+e+"' id='ktalk_live_help' style='z-index:5000; position:fixed; bottom:0px; left:15px; width:250px; border:1px solid #325d88; height:auto;'>            <div style='background-color:#325d88; height:40px; cursor: pointer;' >                <div style='padding-top:8px; padding-left:7px; float:left;'><img                src='https://images.konga.com/v2/s3.amazonaws.com/www.konga.com/system/spree/ktalk/chatIcon.png'/></div>                <div style='padding-top:12px; padding-left:10px; float:left; font-family:Verdana, Geneva, sans-serif; color:#FFF; font-size:12px;'>                    <div id='ktalk_live_help_title' title='"+t+"'                    style='display:inline-block;max-width:163px;text-overflow: ellipsis;white-space: nowrap;overflow: hidden;'>                    "+t+"                    </div>                </div>                <div style='cursor:pointer;padding-top:12px; padding-right:8px; float:right; font-family:Verdana, Geneva, sans-serif; color:#FFF;'>                    <span id='ktalk_live_help_notification'                    style='display:none;font-weight:bold;font-size:12px;height: 15px; width: auto;border-radius:3px;padding:1px 3px;background-color: red;color: #ffffff;'>0</span>                    <span id='ktalk_live_help_header' style='color:white;'>&minus;</span>                    <img id='ktalk_live_help_close_btn' alt='close' title='close'                    src='https://images.konga.com/v2/s3.amazonaws.com/www.konga.com/system/spree/ktalk/prdtListing3.png'/>                </div>            </div>            <div id='ktalk_live_help_body_wrapper' style='background-color: #ffffff;'>                <div id='ktalk_live_help_chat_header' style='background-color:#f6f6f6; height:auto; margin-bottom:5px; padding:5px 10px;display: none;'>                    <span style='font-family:Verdana, Geneva, sans-serif;font-size:12px;'><strong>Question:</strong> <br/><span id='ktalk_live_help_question_display'></span></span><br/></span>                </div>                <div id='ktalk_live_help_form' style='background-color: #ffffff;font-family:Verdana, Geneva, sans-serif;padding:15px 10px;font-size: 12px;'>                     <div style='font-style:italic;font-size: 12px;text-align:center;'>Thank you for Contacting Konga </br>                    In order to chat with an agent we need the following information from you:</div> </br>                    <label style='font-size: 13px;'>Name</label>                    </br>                    <input style='width: 96%;' type='text' id='ktalk_live_help_fullname'/>                    </br>                    <div id='ktalk_live_help_fullname_required' style='display:none;color:red;text-align:right;font-size:10px;'>Please enter your name</div>                    </br>                    <label style='font-size: 11px;'>Email</label>                    </br>                    <input style='width: 96%;' type='text' id='ktalk_live_help_email'/>                    </br>                    <div id='ktalk_live_help_email_required' style='display:none;color:red;text-align:right;font-size:10px;'>Please enter a valid email address</div>                    </br>                    <label style='font-size: 13px;'>How can we help you?</label>                    </br>                    <textarea style='width: 96%;resize:none;font-family:sans-serif;' id='ktalk_live_help_question'></textarea>                    </br>                    <div id='ktalk_live_help_question_required' style='display:none;color:red;text-align:right;font-size:10px;'>We want to know how to help you.</div>                    <div align='center'><button align='center' style='border-radius:3px;border:1px solid #ec841f;background-color:#ffb63d;margin-top:10px;cursor:pointer;padding:5px 50px;font-size:16px;font-weight: bold;' id='ktalk_live_help_form_btn' type='button'>Send</button></div>                </div>                <div id='ktalk_live_help_notice' style='display:none;background-color: #ffffff;font-family:Verdana, Geneva, sans-serif;padding:15px 10px;font-size: 12px;'>                     <div style='font-style:italic;font-size: 12px;text-align:center;'>It has been "+_/6e4+" minutes since you sent a message, your chat session will close in <span id='ktalk_live_help_notice_count_down' style='font-size: 12px;font-weight:bold;'>60</span> seconds.</div> </br>                    <div align='center'><button align='center' style='border-radius:3px;border:1px solid #ec841f;background-color:#ffb63d;margin-top:10px;cursor:pointer;padding:5px 50px;font-size:16px;font-weight: bold;' id='ktalk_live_help_notice_btn' type='button'>Continue</button></div>                </div>            <div id='ktalk_live_help_close_container' style='display:none;background-color: #ffffff;font-family:Verdana, Geneva, sans-serif;padding:15px 10px;font-size: 12px;'>                     <div style='font-style:italic;font-size: 12px;text-align:center;'>Are you sure you want to close this chat? You will not be able to continue this conversation.</div> </br>                    <div align='center'>                    <button align='center' style='border-radius:3px;border:1px solid #ec841f;background-color:#ffb63d;margin-top:10px;cursor:pointer;padding:5px 20px;font-size:16px;font-weight: bold;' id='ktalk_live_help_close_container_yes_btn' type='button'>Yes</button>                    <button align='center' style='border-radius:3px;border:1px solid #ec841f;background-color:#ffb63d;margin-top:10px;cursor:pointer;padding:5px 20px;font-size:16px;font-weight: bold;' id='ktalk_live_help_close_container_no_btn' type='button'>No</button>                    </div>                </div>                <div style='height: 200px;overflow-y: auto;display:none;' id='ktalk_live_help_msg_container'>                </div>                <div style='padding: 10px;display:none;' id='ktalk_live_help_bottom'>                    <span id='ktalk_live_help_typing' style='display:none;font-family:Verdana, Geneva, sans-serif;font-size:11px;'>...typing</span>                    <textarea id='ktalk_live_help_message_box' style='max-height:100px;resize: none;max-width:210px;border-radius:0px; min-width:210px; padding: 5px 7px;'></textarea>                </div>            </div>        </div>";if(jQuery(i).hide().appendTo("body").slideDown(),"undefined"!=typeof konga_customer_info&&(konga_customer_info.logged_in?(jQuery(p.ktalk_live_help_fullname).val(konga_customer_info.firstname+" "+konga_customer_info.lastname).attr("disabled",!0),jQuery(p.ktalk_live_help_email).val(konga_customer_info.email).attr("disabled",!0),jQuery(p.ktalk_live_help_question).focus()):jQuery(p.ktalk_live_help_fullname).focus()),jQuery("#ktalk_live_help_header").on("click",function(){y()}),n){U(),W();var o=null,e=null,s=m.session.question,r=null,a=m.session.helpName;m.speclialist_jid=m.session.toJid,jQuery.each(m.session.chats,function(e,t){t.isMine?b(t.msg,new Date(t.time)):x(t.msg,new Date(t.time))}),C(a,o,r,s,e,!0)}},$=function(){if(E(p.ktalk_link_help_cookie_open))if(E(p.ktalk_live_help_in_progress)){var e=E(p.ktalk_link_help_cookie_room),t=E(p.ktalk_link_help_cookie_title);X(e,t,!0)}else{var e="konga_help",t="Customer Service";E(p.ktalk_link_help_cookie_room)&&(e=E(p.ktalk_link_help_cookie_room),t=E(p.ktalk_link_help_cookie_title)),X(e,t,!1)}},G=function(){var e=window.localStorage;for(var t in e)0==t.indexOf(p.ktalk_live_help_session)&&window.localStorage.removeItem(t)},P=function(e){var t=JSON.stringify(e);e.session_id;return window.localStorage.setItem(p.ktalk_live_help_session,t),e},J=function(e,t,n,i){return{session_id:e,toJid:t,helpName:n,question:i,chats:[]}},W=function(){var e=window.localStorage.getItem(p.ktalk_live_help_session),t=JSON.parse(e);m.session=t},V=function(e,t,n){return{msg:e,time:t,isMine:n}},Y=function(e,t,n){var i="undefined"==typeof n?!1:!0,o=new V(e,t,i);m.session.chats.push(o),P(m.session)},K=function(e){var t=window.linkify(e);return t},Z=function(e,t,n,i){var o=l+"/events/call",s={email:e,fullname:t,question:n,jabber_id:i};jQuery.post(o,s,function(e){if(e.status){localStorage.setItem("ktalk_help_customer_id",e.id),u&&console.log(e);var t=m.connection.jid.split("/")[0],n=null;m.customerId=m.name+"<>"+m.email+"<>"+(new Date).getMilliseconds()+"<>"+m.product+"<>"+m.question+"<>"+t+"<>"+n+"<>"+e.id,M(m.room,m.customerId,!0)}},"json")},ee=function(e,t,n){var i=l+"/events/start",o={customer_id:e,staff_email:t,staff_jabber_id:n};jQuery.post(i,o,function(e){e.status&&u&&console.log(e)},"json")},te=function(e){e&&(clearTimeout(m.intervalId),clearTimeout(m.closeIntervalId),clearInterval(m.countDownId)),m.intervalId=setTimeout(function(){jQuery(p.ktalk_live_help_message_box).attr("disabled",!0),jQuery(p.ktalk_live_help_msg_container).hide(),jQuery(p.ktalk_live_help_notice).show(),m.countDownId=setInterval(function(){ne(p.ktalk_live_help_notice_count_down)},1e3)},_),m.closeIntervalId=setTimeout(function(){var e="You have been logged out due to inactivity.</br>Thank you, Konga";jQuery(p.ktalk_live_help_notice_btn).remove(),jQuery(p.ktalk_live_help_notice).html("<div style='font-style:italic;font-size: 12px;text-align:center;'>"+e+"</div>"),clearInterval(m.countDownId),o()},_+6e4)},ne=function(e){var t=jQuery(e);if("undefined"!=typeof t){var n=t.html().trim();0==n.length&&(n="60");var i=Number(n)-1;t.html(i)}},ie=function(e){m.product_object=e,u&&console.log(m.product_object)},oe=function(e){m.merchant_object=e,u&&console.log(m.merchant_object)},se=function(e){m.customer_info=e,u&&console.log(m.customer_info)},re=function(){var e="https://khelp.igbimo.com/time";jQuery.post(e,{},function(e){if(e){var t=e.d,n=e.h,i=(e.m,n>=p.ktalk_live_help_start_hours&&n<p.ktalk_live_help_end_hours),o=new Date("12/26/2016"),s=new Date("01/01/2017"),r=new Date;B("saturday"!=t&&"sunday"!=t?n>=17?!1:i:o.setHours(0,0,0,0)==r.setHours(0,0,0,0)||s.setHours(0,0,0,0)==r.setHours(0,0,0,0)?!1:!1)}},"json")},ae=function(){i();var e=jQuery("#ktalk_live_help_popout_customer_service");e.length?(e.click(),jQuery(".ktalk_live_help_popout").fadeToggle()):jQuery("#ktalk_live_help_icon").click()},le=function(){re()},he=function(){clearTimeout(m.closeIntervalId),clearTimeout(m.intervalId),clearInterval(m.countDownId)},ce=function(){O(p.ktalk_link_help_cookie_open,"/"),O(p.ktalk_link_help_cookie_room,"/"),O(p.ktalk_link_help_cookie_title,"/"),O(p.ktalk_live_help_in_progress,"/")};return{setProductObject:ie,setMerchantObject:oe,setCustomerInfo:se,startLiveHelp:le,chatWithKonga:ae}},ktalk;jQuery(document).ready(function(){ktalk=new Ktalk("",1),ktalk.startLiveHelp()});